<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Search the best model ‚öôÔ∏è &mdash; Fake and Real Face Detection with ViT 0.0.1 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/nbsphinx-code-cells.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Make predictions with the best model." href="predictions.html" />
    <link rel="prev" title="Vision Transformer Model + Configuration and Metrics üëì" href="vit_model.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Fake and Real Face Detection with ViT
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="context_of_the_project.html">Real and Fake Face Detection (RFFD)</a></li>
<li class="toctree-l1"><a class="reference internal" href="bayesian_optimization.html">Bayesian Optimization from Scratch üîù</a></li>
<li class="toctree-l1"><a class="reference internal" href="generate_and_visualize.html">Generation and Exploration of the Images üîé</a></li>
<li class="toctree-l1"><a class="reference internal" href="preprocessing_and_loading.html">Preprocessing and loading ‚öóÔ∏è</a></li>
<li class="toctree-l1"><a class="reference internal" href="split_dataset.html">Split data ü´ß</a></li>
<li class="toctree-l1"><a class="reference internal" href="vit_model.html">Vision Transformer Model + Configuration and Metrics üëì</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Search the best model ‚öôÔ∏è</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Hyperparameters">Hyperparameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Search-for-the-best-model">Search for the best model</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="predictions.html">Make predictions with the best model.</a></li>
<li class="toctree-l1"><a class="reference internal" href="deploy_to_hugging_face.html">Deploy the ViT Model üöÄ</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Fake and Real Face Detection with ViT</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Search the best model ‚öôÔ∏è</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/notebooks/best_model_search.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Search-the-best-model-‚öôÔ∏è">
<h1>Search the best model ‚öôÔ∏è<a class="headerlink" href="#Search-the-best-model-‚öôÔ∏è" title="Permalink to this heading">ÔÉÅ</a></h1>
<p>This notebook will use the simple Bayesian Optimization algorithm implemented in <a class="reference internal" href="bayesian_optimization.html"><span class="doc">bayesian_optimization</span></a>. To achieve this, we must define the primary hyperparameters and their corresponding search spaces. We must also define functions to help us search for the best combination of hyperparameters and display the results as a parallel coordinate chart in the tensorboard.</p>
<p>Let us begin with the definition of the hyperparameters to tune.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import some libraries</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">fake_face_detection.optimization.fake_face_bayesian_optimization</span> <span class="kn">import</span> <span class="n">SimpleBayesianOptimizationForFakeReal</span>
<span class="kn">from</span> <span class="nn">fake_face_detection.data.fake_face_dataset</span> <span class="kn">import</span> <span class="n">FakeFaceDetectionDataset</span>
<span class="kn">from</span> <span class="nn">fake_face_detection.trainers.custom_trainer</span> <span class="kn">import</span> <span class="n">get_custom_trainer</span>
<span class="kn">from</span> <span class="nn">transformers</span> <span class="kn">import</span> <span class="n">ViTForImageClassification</span><span class="p">,</span> <span class="n">ViTFeatureExtractor</span><span class="p">,</span> <span class="n">Trainer</span>
<span class="kn">from</span> <span class="nn">torchvision.transforms</span> <span class="kn">import</span> <span class="n">Compose</span><span class="p">,</span> <span class="n">transforms</span>
<span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">DataLoader</span>
<span class="kn">import</span> <span class="nn">pytorch_lightning</span> <span class="k">as</span> <span class="nn">pl</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># pl.seed_everything(0)</span>

<span class="c1"># disable wandb</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;WANDB_DISABLED&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span>
</pre></div>
</div>
</div>
<section id="Hyperparameters">
<h2>Hyperparameters<a class="headerlink" href="#Hyperparameters" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>The following hyperparameters will be necessary to train the model:</p>
<ul class="simple">
<li><p>The batch size $ <span class="math">\in `{8, 16}$ :math:</span>rightarrow` the train batch size corresponds to the number of images the model trains on at each sub-iteration of a training epoch.</p></li>
<li><p>The learning rate (<span class="math notranslate nohighlight">\(lr\)</span>) $ <span class="math">\in [1e-5, 1e-3]`$ :math:</span>rightarrow` The learning rate or initial learning rate defines the amount of the gradients that will be used to update the weights. It is sent as an argument to the optimizer.</p></li>
<li><p>The weight decay $ = 0$ <span class="math notranslate nohighlight">\(\rightarrow\)</span> corresponds to a floating number that will be multiplied with the norm of the weights to diminish their effects or regularize them during the training. We didn‚Äôt fix a weight since it doesn‚Äôt provide us a great result at the first training but we kept the explanation on the weight decay usage.</p></li>
</ul>
<p>The optimizer to use is the <code class="docutils literal notranslate"><span class="pre">AdamW</span></code> optimizer. It provides a smoother updating so that the weights do not diverge (stability of the training), and a weight decay is provided to regularize the training and not over-fit. <code class="docutils literal notranslate"><span class="pre">AdamW</span></code> was introduced in <em>Decoupled Weight Decay Regularization</em> (see <a class="reference external" href="https://arxiv.org/pdf/1711.05101">AdamW</a>) by Ilya Loshchilov and Frank Hutter. It is an update to the original <code class="docutils literal notranslate"><span class="pre">Adam</span></code> optimizer, and the algorithm is defined as follows (pseudo-code with Python):</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>```python def adamW(lr: float, betas: tuple (beta_1, beta_2), parameters: [matrix], loss: [function], epsilon:
float, weight_decay: float, amsgrad: bool):</p></td>
</tr>
<tr class="row-even"><td><p>‚Äú‚Äù‚Äù Updating the parameters</p></td>
</tr>
<tr class="row-odd"><td><p>Args: lr (float): The learning rate betas (tuple): The step size of the momentums parameters ([matrix]): The
weights or group of importance inside the model that we want to update loss ([function]): The loss function or
objective epsilon (float): A number to add to the square root of the second momentum to avoid division with zero
weight_decay (float): A float multiplied with the parameters to regularize it amsgrad (bool): Indicate if we want
to normalize the first momentum using the maximum of the second momentum or not</p></td>
</tr>
<tr class="row-even"><td><p>Returns: [matrix]: The updated parameters ‚Äú‚Äù‚Äù</p></td>
</tr>
<tr class="row-odd"><td><p># recuperate the betas beta_1, beta_2 = betas</p></td>
</tr>
<tr class="row-even"><td><p># initialize the first, second moments, and maximum second momentum m = v = v_max = 0</p></td>
</tr>
<tr class="row-odd"><td><p># determine the gradient of the objective compared to the parameters or weights delta = grad(loss) /
grad(parameters)</p></td>
</tr>
<tr class="row-even"><td><p># decay the weights by multiplying with the learning rate, and the weight decay parameters = parameters -
wd<em>lr</em>parameters</p></td>
</tr>
<tr class="row-odd"><td><p># update the first momentum m = beta_1<em>m + (1 - beta_1)</em>delta</p></td>
</tr>
<tr class="row-even"><td><p># update the second momentum v = beta_2<em>v + (1 - beta_2)</em>delta**2</p></td>
</tr>
<tr class="row-odd"><td><p># get the normalized first momentum m_ = m/(1 - beta_1)</p></td>
</tr>
<tr class="row-even"><td><p># get the normalized second momentum v_ = v/(1 - beta_2)</p></td>
</tr>
<tr class="row-odd"><td><p>if amsgrad: # if amsgrad is set to True</p></td>
</tr>
<tr class="row-even"><td><p># take the maximum between the normalized and the last maximum second momentum v_max = max(v_max, <a href="#id1"><span class="problematic" id="id2">v_</span></a>)</p></td>
</tr>
<tr class="row-odd"><td><p># update the weights with the maximum second momentum parameters = parameters - lr*m_ / (sqrt(v_max) + epsilon)</p></td>
</tr>
<tr class="row-even"><td><p>else: # if amsgrad is set to False</p></td>
</tr>
<tr class="row-odd"><td><p># update the parameters with the normalized second momentum parameters = parameters - lr*m_ / (sqrt(<a href="#id3"><span class="problematic" id="id4">v_</span></a>) + epsilon)</p></td>
</tr>
<tr class="row-even"><td><p>return parameters</p></td>
</tr>
<tr class="row-odd"><td><p>```</p></td>
</tr>
</tbody>
</table>
<p>Another thing to define is the learning rate scheduler. His role is to linearly augment the learning rate proportionally to several steps named the warmup steps and beginning to linearly decay after the warmup steps until reaching zero at the end of the training. A step increase at each time we update the parameters. That is the following pseudo-code (see the actual code <a class="reference external" href="https://github.com/huggingface/transformers/blob/v4.29.1/src/transformers/optimization.py#L100">true_code</a>):</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>```python def linear_learning_rate_scheduling_with_warmup(initial_lr: float, current_step: int, warmup_steps: int,
max_training_step: int): ‚Äú‚Äù‚Äù Linearly decay the learning after a warmup steps</p></td>
</tr>
<tr class="row-even"><td><p>Args: initial_lr (float): The initial learning rate of a specific group of weights current_step (int): The current step of the
training warmup_steps (int): The number os steps before beginning to decay the learning rate max_training_step (int): The
maximum number of training steps ‚Äú‚Äù‚Äù</p></td>
</tr>
<tr class="row-odd"><td><p>if current_step &lt; warmup_step: # if the warmup_steps is not yet reached</p></td>
</tr>
<tr class="row-even"><td><p># We take a part of the initial learning proportional to the number of steps already reached before the warmup steps return
initial_lr*float(current_step) / float(warmup_step)</p></td>
</tr>
<tr class="row-odd"><td><p>else: # if the warmup step is already reached</p></td>
</tr>
<tr class="row-even"><td><p># We take a part of the initial learning proportional to the number of steps that it remains to travel since the warmup steps
return initial_lr*float(max_training_steps - current_step) / float(max_training_steps - warmup_step)</p></td>
</tr>
<tr class="row-odd"><td><p>```</p></td>
</tr>
</tbody>
</table>
<p>Let us initialize below the search spaces according to that defined in <a class="reference internal" href="bayesian_optimization.html"><span class="doc">bayesian_optimization</span></a>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">search_spaces</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;lr&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="mf">1e-5</span><span class="p">,</span>
        <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="mf">1e-4</span> <span class="c1"># lower is better</span>
    <span class="p">},</span>
    <span class="s1">&#39;batch_size&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">16</span>
    <span class="p">},</span>
    <span class="s1">&#39;h_flip_p&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="mf">0.5</span>
    <span class="p">},</span>
    <span class="s1">&#39;v_flip_p&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="mf">0.5</span>
    <span class="p">},</span>
    <span class="s1">&#39;gray_scale_p&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="mf">0.5</span>
    <span class="p">},</span>
    <span class="s1">&#39;rotation&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;values&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>In the next section, we will search for the best model using randomly generated samples from the search spaces.</p>
</section>
<section id="Search-for-the-best-model">
<h2>Search for the best model<a class="headerlink" href="#Search-for-the-best-model" title="Permalink to this heading">ÔÉÅ</a></h2>
<p>In this section, we must load the ViT Model and the custom hugging face trainer we configured in <a class="reference internal" href="preprocessing_and_loading.html"><span class="doc">preprocessing_and_loading</span></a>. Let us recuperate the two.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># recuperate the labels weights</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;data/extractions/weights.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>

    <span class="n">depick</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">Unpickler</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="n">weights</span> <span class="o">=</span> <span class="n">depick</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

<span class="c1"># recuperate the image characteristics</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;data/extractions/fake_real_dict.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>

    <span class="n">depick</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">Unpickler</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="n">characs</span> <span class="o">=</span> <span class="n">depick</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

<span class="c1"># define the model name</span>
<span class="n">model_name</span> <span class="o">=</span> <span class="s1">&#39;google/vit-base-patch16-224-in21k&#39;</span>

<span class="c1"># initialize the model without calling it</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span>
    <span class="n">ViTForImageClassification</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">,</span>
    <span class="n">model_name</span><span class="p">,</span>
    <span class="n">num_labels</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">characs</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span>
    <span class="n">id2label</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">key</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">characs</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
    <span class="n">label2id</span> <span class="o">=</span> <span class="n">characs</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]</span>
    <span class="p">)</span>

<span class="c1"># recuperate the trainer class</span>
<span class="n">Trainer</span> <span class="o">=</span> <span class="n">get_custom_trainer</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>We must also define the training and validation datasets with the ViT Model‚Äôs feature extractor as their Transformer. Only the training set requires an augmentation strategy. So we will make them inside a function.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># initialize the feature extractor</span>
<span class="n">feature_extractor</span> <span class="o">=</span> <span class="n">ViTFeatureExtractor</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_datasets</span><span class="p">(</span><span class="n">h_flip_p</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">v_flip_p</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">gray_scale_p</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">rotation</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>

    <span class="c1"># define a empty function</span>
    <span class="n">empty</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span>

    <span class="c1"># initialize the training transformer</span>
    <span class="n">training_transformer</span> <span class="o">=</span> <span class="n">Compose</span><span class="p">([</span>
        <span class="n">transforms</span><span class="o">.</span><span class="n">RandomHorizontalFlip</span><span class="p">(</span><span class="n">h_flip_p</span><span class="p">),</span>
        <span class="n">transforms</span><span class="o">.</span><span class="n">RandomVerticalFlip</span><span class="p">(</span><span class="n">v_flip_p</span><span class="p">),</span>
        <span class="n">transforms</span><span class="o">.</span><span class="n">RandomGrayscale</span><span class="p">(</span><span class="n">gray_scale_p</span><span class="p">),</span>
        <span class="n">transforms</span><span class="o">.</span><span class="n">RandomRotation</span><span class="p">(</span><span class="n">degrees</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">90</span><span class="p">))</span> <span class="k">if</span> <span class="n">rotation</span> <span class="k">else</span> <span class="n">empty</span><span class="p">,</span>
        <span class="n">partial</span><span class="p">(</span><span class="n">feature_extractor</span><span class="p">,</span> <span class="n">return_tensors</span> <span class="o">=</span> <span class="s1">&#39;pt&#39;</span><span class="p">)</span>
    <span class="p">])</span>

    <span class="c1"># define the path</span>
    <span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;data/real_and_fake_splits&#39;</span>

    <span class="c1"># recuperate the training dataset</span>
    <span class="n">train_dataset</span> <span class="o">=</span> <span class="n">FakeFaceDetectionDataset</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">/train/training_fake&quot;</span><span class="p">,</span>
                                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">/train/training_real&quot;</span><span class="p">,</span>
                                             <span class="n">characs</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">],</span>
                                             <span class="n">training_transformer</span><span class="p">)</span>

    <span class="c1"># recuperate the validation dataset</span>
    <span class="n">valid_dataset</span> <span class="o">=</span> <span class="n">FakeFaceDetectionDataset</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">/valid/training_fake&quot;</span><span class="p">,</span>
                                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">/valid/training_real&quot;</span><span class="p">,</span>
                                             <span class="n">characs</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">],</span>
                                             <span class="n">feature_extractor</span><span class="p">,</span> <span class="n">transformer_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;return_tensors&#39;</span><span class="p">:</span> <span class="s1">&#39;pt&#39;</span><span class="p">})</span>

    <span class="k">return</span> <span class="n">train_dataset</span><span class="p">,</span> <span class="n">valid_dataset</span>
</pre></div>
</div>
</div>
<p>Let us now create the training function below. We will use the <code class="docutils literal notranslate"><span class="pre">compute_metrics</span></code> function that we created in <a class="reference internal" href="vit_model.html"><span class="doc">vit_model</span></a> for the prediction to calculate the metrics and the <code class="docutils literal notranslate"><span class="pre">data_collator</span></code> that we created in <a class="reference internal" href="preprocessing_and_loading.html"><span class="doc">preprocessing_and_loading</span></a> to make the model load the images.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> fake-face-detection/fake_face_detection/trainers/search_train.py

<span class="kn">from</span> <span class="nn">fake_face_detection.metrics.compute_metrics</span> <span class="kn">import</span> <span class="n">compute_metrics</span>
<span class="kn">from</span> <span class="nn">fake_face_detection.data.collator</span> <span class="kn">import</span> <span class="n">fake_face_collator</span>
<span class="kn">from</span> <span class="nn">transformers</span> <span class="kn">import</span> <span class="n">Trainer</span><span class="p">,</span> <span class="n">TrainingArguments</span><span class="p">,</span> <span class="n">set_seed</span>
<span class="kn">from</span> <span class="nn">torch.utils.tensorboard</span> <span class="kn">import</span> <span class="n">SummaryWriter</span>
<span class="kn">from</span> <span class="nn">torch</span> <span class="kn">import</span> <span class="n">nn</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="n">epochs</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span> <span class="n">trainer</span><span class="p">,</span> <span class="n">get_datasets</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">log_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;fake_face_logs&quot;</span><span class="p">,</span> <span class="n">metric</span> <span class="o">=</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;------------------------- Beginning of training&quot;</span><span class="p">)</span>

    <span class="n">set_seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>

    <span class="c1"># initialize the model</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="p">()</span>

    <span class="c1"># reformat the config integer type</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">):</span> <span class="n">config</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="n">pretty</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Current Config: </span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">pretty</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Checkpoints in </span><span class="si">{</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># recuperate the dataset</span>
    <span class="n">train_dataset</span><span class="p">,</span> <span class="n">test_dataset</span> <span class="o">=</span> <span class="n">get_datasets</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;h_flip_p&#39;</span><span class="p">],</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;v_flip_p&#39;</span><span class="p">],</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;gray_scale_p&#39;</span><span class="p">],</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;rotation&#39;</span><span class="p">])</span>

    <span class="c1"># initialize the arguments of the training</span>
    <span class="n">training_args</span> <span class="o">=</span> <span class="n">TrainingArguments</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span>
                                      <span class="n">per_device_train_batch_size</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;batch_size&#39;</span><span class="p">],</span>
                                      <span class="n">evaluation_strategy</span><span class="o">=</span><span class="s1">&#39;epoch&#39;</span><span class="p">,</span>
                                      <span class="n">save_strategy</span><span class="o">=</span><span class="s1">&#39;epoch&#39;</span><span class="p">,</span>
                                      <span class="n">logging_strategy</span><span class="o">=</span><span class="s1">&#39;epoch&#39;</span><span class="p">,</span>
                                      <span class="n">num_train_epochs</span><span class="o">=</span><span class="n">epochs</span><span class="p">,</span>
                                      <span class="n">fp16</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                      <span class="n">save_total_limit</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                      <span class="n">push_to_hub</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                      <span class="n">logging_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">log_dir</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)),</span>
                                      <span class="n">load_best_model_at_end</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                      <span class="n">learning_rate</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;lr&#39;</span><span class="p">]</span>
                                      <span class="p">)</span>

    <span class="c1"># train the model</span>
    <span class="n">trainer_</span> <span class="o">=</span> <span class="n">trainer</span><span class="p">(</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="p">,</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">training_args</span><span class="p">,</span>
        <span class="n">data_collator</span> <span class="o">=</span> <span class="n">fake_face_collator</span><span class="p">,</span>
        <span class="n">compute_metrics</span> <span class="o">=</span> <span class="n">compute_metrics</span><span class="p">,</span>
        <span class="n">train_dataset</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="p">,</span>
        <span class="n">eval_dataset</span> <span class="o">=</span> <span class="n">test_dataset</span>
    <span class="p">)</span>

    <span class="c1"># train the model</span>
    <span class="n">trainer_</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>

    <span class="c1"># evaluate the model and recuperate metrics</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="n">trainer_</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">test_dataset</span><span class="p">)</span>

    <span class="c1"># add metrics and config to the hyperparameter panel of tensorboard</span>
    <span class="k">with</span> <span class="n">SummaryWriter</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">log_dir</span><span class="p">,</span> <span class="s1">&#39;hparams&#39;</span><span class="p">))</span> <span class="k">as</span> <span class="n">logger</span><span class="p">:</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">add_hparams</span><span class="p">(</span>
            <span class="n">config</span><span class="p">,</span> <span class="n">metrics</span>
        <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;------------------------- End of training&quot;</span><span class="p">)</span>
    <span class="c1"># recuperate the metric to evaluate</span>
    <span class="k">return</span> <span class="n">metrics</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;eval_</span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Overwriting fake-face-detection/fake_face_detection/trainers/search_train.py
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">run</span> fake-face-detection/fake_face_detection/trainers/search_train.py
</pre></div>
</div>
</div>
<p>We implemented a new Bayesian optimization function based on our original one (<a class="reference internal" href="bayesian_optimization.html"><span class="doc">bayesian_optimization</span></a>), and that can find the code here <a class="reference external" href="fake_face_bayesian_optimization.py">bayesian_optimization_for_fake_face_pred</a>. It will make many evaluation steps to find the combination of hyperparameters providing us with the best model. Notice that each trial will provide a model that must be locally saved. The number of epochs can be fixed to <code class="docutils literal notranslate"><span class="pre">4</span></code> and the number of
attempts to <code class="docutils literal notranslate"><span class="pre">20</span></code>. Moreover, the scale size will be taken as default <code class="docutils literal notranslate"><span class="pre">0.1</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">f1</span></code> will be chosen as our principal metric.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">EPOCHS</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">TRIALS</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># We will make the trial 2 by 2 until reaching the desired number of trials</span>

<span class="c1"># let us initialize the arguments before the training function be fed</span>
<span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;epochs&#39;</span><span class="p">:</span> <span class="n">EPOCHS</span><span class="p">,</span>
        <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="n">model</span><span class="p">,</span>
        <span class="s1">&#39;trainer&#39;</span><span class="p">:</span> <span class="n">Trainer</span><span class="p">,</span>
        <span class="s1">&#39;get_datasets&#39;</span><span class="p">:</span> <span class="n">get_datasets</span><span class="p">,</span>
        <span class="s1">&#39;seed&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;metric&#39;</span><span class="p">:</span> <span class="s1">&#39;f1&#39;</span><span class="p">}</span>

<span class="c1"># let us instantiate the search function we will indicate the output dir as random kwarg initialization of the trainer</span>
<span class="n">bo_search</span> <span class="o">=</span> <span class="n">SimpleBayesianOptimizationForFakeReal</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">search_spaces</span><span class="p">,</span> <span class="n">random_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;output_dir&#39;</span><span class="p">:</span> <span class="s1">&#39;data/checkpoints/model_&#39;</span><span class="p">},</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">checkpoint</span><span class="o">=</span><span class="s1">&#39;data/trials/checkpoint_2.txt&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
------------------------- Beginning of training
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Some weights of the model checkpoint at google/vit-base-patch16-224-in21k were not used when initializing ViTForImageClassification: [&#39;pooler.dense.weight&#39;, &#39;pooler.dense.bias&#39;]
- This IS expected if you are initializing ViTForImageClassification from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing ViTForImageClassification from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of ViTForImageClassification were not initialized from the model checkpoint at google/vit-base-patch16-224-in21k and are newly initialized: [&#39;classifier.bias&#39;, &#39;classifier.weight&#39;]
You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Current Config:
 {
    &#34;lr&#34;: 9.689183977257256e-05,
    &#34;batch_size&#34;: 16,
    &#34;h_flip_p&#34;: 0.24296384828140632,
    &#34;v_flip_p&#34;: 0.4591171658925659,
    &#34;gray_scale_p&#34;: 0.4149264518294957,
    &#34;rotation&#34;: 1
}
Checkpoints in data/checkpoints/model_2yW4Acq
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Using the `WANDB_DISABLED` environment variable is deprecated and will be removed in v5. Use the --report_to flag to control the integrations used for logging result (for instance --report_to none).
 25%|‚ñà‚ñà‚ñå       | 110/440 [01:53&lt;05:13,  1.05it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.6821, &#39;learning_rate&#39;: 7.266887982942942e-05, &#39;epoch&#39;: 1.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 25%|‚ñà‚ñà‚ñå       | 110/440 [02:00&lt;05:13,  1.05it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.6410195827484131, &#39;eval_accuracy&#39;: 0.654054054054054, &#39;eval_f1&#39;: 0.6404494382022472, &#39;eval_runtime&#39;: 6.895, &#39;eval_samples_per_second&#39;: 26.831, &#39;eval_steps_per_second&#39;: 3.481, &#39;epoch&#39;: 1.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 220/440 [04:34&lt;04:00,  1.10s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.6174, &#39;learning_rate&#39;: 4.844591988628628e-05, &#39;epoch&#39;: 2.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 220/440 [04:43&lt;04:00,  1.10s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.5273972153663635, &#39;eval_accuracy&#39;: 0.7351351351351352, &#39;eval_f1&#39;: 0.7537688442211056, &#39;eval_runtime&#39;: 8.5588, &#39;eval_samples_per_second&#39;: 21.615, &#39;eval_steps_per_second&#39;: 2.804, &#39;epoch&#39;: 2.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 330/440 [07:08&lt;01:48,  1.01it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.5266, &#39;learning_rate&#39;: 2.422295994314314e-05, &#39;epoch&#39;: 3.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 330/440 [07:15&lt;01:48,  1.01it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.5722827911376953, &#39;eval_accuracy&#39;: 0.7081081081081081, &#39;eval_f1&#39;: 0.6625, &#39;eval_runtime&#39;: 6.9199, &#39;eval_samples_per_second&#39;: 26.734, &#39;eval_steps_per_second&#39;: 3.468, &#39;epoch&#39;: 3.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [09:41&lt;00:00,  1.74s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.4339, &#39;learning_rate&#39;: 0.0, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [09:51&lt;00:00,  1.74s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.4269016683101654, &#39;eval_accuracy&#39;: 0.8054054054054054, &#39;eval_f1&#39;: 0.8105263157894738, &#39;eval_runtime&#39;: 10.0503, &#39;eval_samples_per_second&#39;: 18.407, &#39;eval_steps_per_second&#39;: 2.388, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [10:04&lt;00:00,  1.37s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;train_runtime&#39;: 605.1563, &#39;train_samples_per_second&#39;: 11.587, &#39;train_steps_per_second&#39;: 0.727, &#39;train_loss&#39;: 0.5650030482899059, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 24/24 [00:06&lt;00:00,  3.80it/s]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.4269016683101654, &#39;eval_accuracy&#39;: 0.8054054054054054, &#39;eval_f1&#39;: 0.8105263157894738, &#39;eval_runtime&#39;: 6.9234, &#39;eval_samples_per_second&#39;: 26.721, &#39;eval_steps_per_second&#39;: 3.467, &#39;epoch&#39;: 4.0}
------------------------- End of training
</pre></div></div>
</div>
<p>Let us make 20 trials.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bo_search</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">n_trials</span><span class="o">=</span><span class="n">TRIALS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;output_dir&#39;: &#39;data/checkpoints/model_JulUpak&#39;}
------------------------- Beginning of training
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Some weights of the model checkpoint at google/vit-base-patch16-224-in21k were not used when initializing ViTForImageClassification: [&#39;pooler.dense.weight&#39;, &#39;pooler.dense.bias&#39;]
- This IS expected if you are initializing ViTForImageClassification from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing ViTForImageClassification from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of ViTForImageClassification were not initialized from the model checkpoint at google/vit-base-patch16-224-in21k and are newly initialized: [&#39;classifier.bias&#39;, &#39;classifier.weight&#39;]
You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.
Using the `WANDB_DISABLED` environment variable is deprecated and will be removed in v5. Use the --report_to flag to control the integrations used for logging result (for instance --report_to none).
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Current Config:
 {
    &#34;lr&#34;: 1.6528880304384158e-05,
    &#34;batch_size&#34;: 16,
    &#34;h_flip_p&#34;: 0.22914276130929306,
    &#34;v_flip_p&#34;: 0.4992272204272212,
    &#34;gray_scale_p&#34;: 0.4980482239275472,
    &#34;rotation&#34;: 1
}
Checkpoints in data/checkpoints/model_JulUpak
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 25%|‚ñà‚ñà‚ñå       | 110/440 [02:06&lt;05:37,  1.02s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.6833, &#39;learning_rate&#39;: 1.2396660228288119e-05, &#39;epoch&#39;: 1.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 25%|‚ñà‚ñà‚ñå       | 110/440 [02:14&lt;05:37,  1.02s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.6644940376281738, &#39;eval_accuracy&#39;: 0.6486486486486487, &#39;eval_f1&#39;: 0.6766169154228856, &#39;eval_runtime&#39;: 8.0831, &#39;eval_samples_per_second&#39;: 22.887, &#39;eval_steps_per_second&#39;: 2.969, &#39;epoch&#39;: 1.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 220/440 [04:22&lt;03:34,  1.02it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.6255, &#39;learning_rate&#39;: 8.264440152192079e-06, &#39;epoch&#39;: 2.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 220/440 [04:29&lt;03:34,  1.02it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.613722026348114, &#39;eval_accuracy&#39;: 0.7135135135135136, &#39;eval_f1&#39;: 0.7644444444444445, &#39;eval_runtime&#39;: 6.967, &#39;eval_samples_per_second&#39;: 26.554, &#39;eval_steps_per_second&#39;: 3.445, &#39;epoch&#39;: 2.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 330/440 [06:54&lt;01:52,  1.03s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.5703, &#39;learning_rate&#39;: 4.1697857131514576e-06, &#39;epoch&#39;: 3.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 330/440 [07:02&lt;01:52,  1.03s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.562276303768158, &#39;eval_accuracy&#39;: 0.7567567567567568, &#39;eval_f1&#39;: 0.7738693467336683, &#39;eval_runtime&#39;: 8.1622, &#39;eval_samples_per_second&#39;: 22.665, &#39;eval_steps_per_second&#39;: 2.94, &#39;epoch&#39;: 3.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [09:32&lt;00:00,  1.07s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.5349, &#39;learning_rate&#39;: 3.756563705541854e-08, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [09:38&lt;00:00,  1.07s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.5485998392105103, &#39;eval_accuracy&#39;: 0.7621621621621621, &#39;eval_f1&#39;: 0.7708333333333333, &#39;eval_runtime&#39;: 6.5352, &#39;eval_samples_per_second&#39;: 28.308, &#39;eval_steps_per_second&#39;: 3.672, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [09:50&lt;00:00,  1.34s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;train_runtime&#39;: 590.5965, &#39;train_samples_per_second&#39;: 11.873, &#39;train_steps_per_second&#39;: 0.745, &#39;train_loss&#39;: 0.6034778334877707, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 24/24 [00:08&lt;00:00,  2.96it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.5485998392105103, &#39;eval_accuracy&#39;: 0.7621621621621621, &#39;eval_f1&#39;: 0.7708333333333333, &#39;eval_runtime&#39;: 7.9004, &#39;eval_samples_per_second&#39;: 23.417, &#39;eval_steps_per_second&#39;: 3.038, &#39;epoch&#39;: 4.0}
------------------------- End of training
{&#39;output_dir&#39;: &#39;data/checkpoints/model_MmLN65b&#39;}
------------------------- Beginning of training
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Some weights of the model checkpoint at google/vit-base-patch16-224-in21k were not used when initializing ViTForImageClassification: [&#39;pooler.dense.weight&#39;, &#39;pooler.dense.bias&#39;]
- This IS expected if you are initializing ViTForImageClassification from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing ViTForImageClassification from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of ViTForImageClassification were not initialized from the model checkpoint at google/vit-base-patch16-224-in21k and are newly initialized: [&#39;classifier.bias&#39;, &#39;classifier.weight&#39;]
You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.
Using the `WANDB_DISABLED` environment variable is deprecated and will be removed in v5. Use the --report_to flag to control the integrations used for logging result (for instance --report_to none).
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Current Config:
 {
    &#34;lr&#34;: 7.862597200676361e-05,
    &#34;batch_size&#34;: 16,
    &#34;h_flip_p&#34;: 0.26968951505981287,
    &#34;v_flip_p&#34;: 0.3893132393152791,
    &#34;gray_scale_p&#34;: 0.26517683609758874,
    &#34;rotation&#34;: 1
}
Checkpoints in data/checkpoints/model_MmLN65b
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 25%|‚ñà‚ñà‚ñå       | 110/440 [02:00&lt;05:28,  1.00it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.6659, &#39;learning_rate&#39;: 5.8969479005072705e-05, &#39;epoch&#39;: 1.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 25%|‚ñà‚ñà‚ñå       | 110/440 [02:07&lt;05:28,  1.00it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.6332506537437439, &#39;eval_accuracy&#39;: 0.6756756756756757, &#39;eval_f1&#39;: 0.7457627118644068, &#39;eval_runtime&#39;: 6.3941, &#39;eval_samples_per_second&#39;: 28.933, &#39;eval_steps_per_second&#39;: 3.753, &#39;epoch&#39;: 1.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 220/440 [04:13&lt;03:48,  1.04s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.5681, &#39;learning_rate&#39;: 3.9312986003381806e-05, &#39;epoch&#39;: 2.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 220/440 [04:21&lt;03:48,  1.04s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.4887477457523346, &#39;eval_accuracy&#39;: 0.7783783783783784, &#39;eval_f1&#39;: 0.8056872037914692, &#39;eval_runtime&#39;: 8.1547, &#39;eval_samples_per_second&#39;: 22.686, &#39;eval_steps_per_second&#39;: 2.943, &#39;epoch&#39;: 2.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 330/440 [06:35&lt;01:48,  1.02it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.4533, &#39;learning_rate&#39;: 1.9656493001690903e-05, &#39;epoch&#39;: 3.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 330/440 [06:42&lt;01:48,  1.02it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.48847970366477966, &#39;eval_accuracy&#39;: 0.7945945945945946, &#39;eval_f1&#39;: 0.7956989247311828, &#39;eval_runtime&#39;: 6.8166, &#39;eval_samples_per_second&#39;: 27.14, &#39;eval_steps_per_second&#39;: 3.521, &#39;epoch&#39;: 3.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [08:57&lt;00:00,  1.00s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.371, &#39;learning_rate&#39;: 0.0, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [09:06&lt;00:00,  1.00s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.4256192445755005, &#39;eval_accuracy&#39;: 0.7945945945945946, &#39;eval_f1&#39;: 0.806122448979592, &#39;eval_runtime&#39;: 8.5378, &#39;eval_samples_per_second&#39;: 21.668, &#39;eval_steps_per_second&#39;: 2.811, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [09:20&lt;00:00,  1.27s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;train_runtime&#39;: 560.6743, &#39;train_samples_per_second&#39;: 12.506, &#39;train_steps_per_second&#39;: 0.785, &#39;train_loss&#39;: 0.5145724036476829, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 24/24 [00:06&lt;00:00,  3.51it/s]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.4256192445755005, &#39;eval_accuracy&#39;: 0.7945945945945946, &#39;eval_f1&#39;: 0.806122448979592, &#39;eval_runtime&#39;: 7.2337, &#39;eval_samples_per_second&#39;: 25.575, &#39;eval_steps_per_second&#39;: 3.318, &#39;epoch&#39;: 4.0}
------------------------- End of training
</pre></div></div>
</div>
<hr class="docutils" />
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">EPOCHS</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">TRIALS</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># We will make the trial 2 by 2 until reaching the desired number of trials</span>

<span class="c1"># let us initialize the arguments before the training function be fed</span>
<span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;epochs&#39;</span><span class="p">:</span> <span class="n">EPOCHS</span><span class="p">,</span>
        <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="n">model</span><span class="p">,</span>
        <span class="s1">&#39;trainer&#39;</span><span class="p">:</span> <span class="n">Trainer</span><span class="p">,</span>
        <span class="s1">&#39;get_datasets&#39;</span><span class="p">:</span> <span class="n">get_datasets</span><span class="p">,</span>
        <span class="s1">&#39;seed&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;metric&#39;</span><span class="p">:</span> <span class="s1">&#39;f1&#39;</span><span class="p">}</span>


<span class="c1"># let us instantiate the search function we will indicate the output dir as random kwarg initialization of the trainer</span>
<span class="n">bo_search</span> <span class="o">=</span> <span class="n">SimpleBayesianOptimizationForFakeReal</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">search_spaces</span><span class="p">,</span> <span class="n">random_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;output_dir&#39;</span><span class="p">:</span> <span class="s1">&#39;data/checkpoints/model_&#39;</span><span class="p">},</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">checkpoint</span><span class="o">=</span><span class="s1">&#39;data/trials/checkpoint_2.txt&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Checkpoint loaded at trial 2
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bo_search</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">n_trials</span><span class="o">=</span><span class="n">TRIALS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;output_dir&#39;: &#39;data/checkpoints/model_Md7dObb&#39;}
------------------------- Beginning of training
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Some weights of the model checkpoint at google/vit-base-patch16-224-in21k were not used when initializing ViTForImageClassification: [&#39;pooler.dense.weight&#39;, &#39;pooler.dense.bias&#39;]
- This IS expected if you are initializing ViTForImageClassification from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing ViTForImageClassification from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of ViTForImageClassification were not initialized from the model checkpoint at google/vit-base-patch16-224-in21k and are newly initialized: [&#39;classifier.bias&#39;, &#39;classifier.weight&#39;]
You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.
Using the `WANDB_DISABLED` environment variable is deprecated and will be removed in v5. Use the --report_to flag to control the integrations used for logging result (for instance --report_to none).
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Current Config:
 {
    &#34;lr&#34;: 8.066164211147095e-05,
    &#34;batch_size&#34;: 16,
    &#34;h_flip_p&#34;: 0.14262461447346014,
    &#34;v_flip_p&#34;: 0.34829575180008127,
    &#34;gray_scale_p&#34;: 0.365252658707733,
    &#34;rotation&#34;: 1
}
Checkpoints in data/checkpoints/model_Md7dObb
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 25%|‚ñà‚ñà‚ñå       | 110/440 [02:06&lt;05:37,  1.02s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.6865, &#39;learning_rate&#39;: 6.049623158360321e-05, &#39;epoch&#39;: 1.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 25%|‚ñà‚ñà‚ñå       | 110/440 [02:14&lt;05:37,  1.02s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.6505582332611084, &#39;eval_accuracy&#39;: 0.6324324324324324, &#39;eval_f1&#39;: 0.6458333333333333, &#39;eval_runtime&#39;: 7.8127, &#39;eval_samples_per_second&#39;: 23.679, &#39;eval_steps_per_second&#39;: 3.072, &#39;epoch&#39;: 1.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 220/440 [03:58&lt;02:55,  1.25it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.6299, &#39;learning_rate&#39;: 4.0330821055735474e-05, &#39;epoch&#39;: 2.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 220/440 [04:04&lt;02:55,  1.25it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.5699502229690552, &#39;eval_accuracy&#39;: 0.7243243243243244, &#39;eval_f1&#39;: 0.7753303964757708, &#39;eval_runtime&#39;: 5.8556, &#39;eval_samples_per_second&#39;: 31.594, &#39;eval_steps_per_second&#39;: 4.099, &#39;epoch&#39;: 2.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 330/440 [06:26&lt;02:09,  1.18s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.5014, &#39;learning_rate&#39;: 2.0165410527867737e-05, &#39;epoch&#39;: 3.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 330/440 [06:34&lt;02:09,  1.18s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.584014892578125, &#39;eval_accuracy&#39;: 0.7351351351351352, &#39;eval_f1&#39;: 0.7262569832402235, &#39;eval_runtime&#39;: 8.1066, &#39;eval_samples_per_second&#39;: 22.821, &#39;eval_steps_per_second&#39;: 2.961, &#39;epoch&#39;: 3.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [08:19&lt;00:00,  1.27it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.4147, &#39;learning_rate&#39;: 0.0, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [08:26&lt;00:00,  1.27it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.4597586989402771, &#39;eval_accuracy&#39;: 0.8, &#39;eval_f1&#39;: 0.8229665071770335, &#39;eval_runtime&#39;: 6.4915, &#39;eval_samples_per_second&#39;: 28.499, &#39;eval_steps_per_second&#39;: 3.697, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [08:36&lt;00:00,  1.17s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;train_runtime&#39;: 516.6343, &#39;train_samples_per_second&#39;: 13.572, &#39;train_steps_per_second&#39;: 0.852, &#39;train_loss&#39;: 0.5581029718572443, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 24/24 [00:06&lt;00:00,  3.77it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.4597586989402771, &#39;eval_accuracy&#39;: 0.8, &#39;eval_f1&#39;: 0.8229665071770335, &#39;eval_runtime&#39;: 6.7694, &#39;eval_samples_per_second&#39;: 27.329, &#39;eval_steps_per_second&#39;: 3.545, &#39;epoch&#39;: 4.0}
------------------------- End of training
{&#39;output_dir&#39;: &#39;data/checkpoints/model_VM4aeIs&#39;}
------------------------- Beginning of training
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Some weights of the model checkpoint at google/vit-base-patch16-224-in21k were not used when initializing ViTForImageClassification: [&#39;pooler.dense.weight&#39;, &#39;pooler.dense.bias&#39;]
- This IS expected if you are initializing ViTForImageClassification from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing ViTForImageClassification from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of ViTForImageClassification were not initialized from the model checkpoint at google/vit-base-patch16-224-in21k and are newly initialized: [&#39;classifier.bias&#39;, &#39;classifier.weight&#39;]
You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.
Using the `WANDB_DISABLED` environment variable is deprecated and will be removed in v5. Use the --report_to flag to control the integrations used for logging result (for instance --report_to none).
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Current Config:
 {
    &#34;lr&#34;: 4.7730242380228524e-05,
    &#34;batch_size&#34;: 16,
    &#34;h_flip_p&#34;: 0.29183614464561236,
    &#34;v_flip_p&#34;: 0.26139135776597944,
    &#34;gray_scale_p&#34;: 0.4673531288682136,
    &#34;rotation&#34;: 1
}
Checkpoints in data/checkpoints/model_VM4aeIs
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 25%|‚ñà‚ñà‚ñå       | 110/440 [01:33&lt;04:21,  1.26it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.6602, &#39;learning_rate&#39;: 3.579768178517139e-05, &#39;epoch&#39;: 1.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 25%|‚ñà‚ñà‚ñå       | 110/440 [01:40&lt;04:21,  1.26it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.5871238708496094, &#39;eval_accuracy&#39;: 0.7243243243243244, &#39;eval_f1&#39;: 0.7272727272727273, &#39;eval_runtime&#39;: 6.7151, &#39;eval_samples_per_second&#39;: 27.55, &#39;eval_steps_per_second&#39;: 3.574, &#39;epoch&#39;: 1.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 220/440 [03:30&lt;03:23,  1.08it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.5699, &#39;learning_rate&#39;: 2.3865121190114262e-05, &#39;epoch&#39;: 2.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 220/440 [03:38&lt;03:23,  1.08it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.5288792252540588, &#39;eval_accuracy&#39;: 0.7351351351351352, &#39;eval_f1&#39;: 0.7860262008733626, &#39;eval_runtime&#39;: 7.9145, &#39;eval_samples_per_second&#39;: 23.375, &#39;eval_steps_per_second&#39;: 3.032, &#39;epoch&#39;: 2.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 330/440 [06:20&lt;02:07,  1.16s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.5004, &#39;learning_rate&#39;: 1.1932560595057131e-05, &#39;epoch&#39;: 3.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 330/440 [06:28&lt;02:07,  1.16s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.47091954946517944, &#39;eval_accuracy&#39;: 0.7675675675675676, &#39;eval_f1&#39;: 0.7942583732057418, &#39;eval_runtime&#39;: 7.947, &#39;eval_samples_per_second&#39;: 23.279, &#39;eval_steps_per_second&#39;: 3.02, &#39;epoch&#39;: 3.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [08:13&lt;00:00,  1.33it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.4184, &#39;learning_rate&#39;: 0.0, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [08:20&lt;00:00,  1.33it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.43839508295059204, &#39;eval_accuracy&#39;: 0.7837837837837838, &#39;eval_f1&#39;: 0.8058252427184466, &#39;eval_runtime&#39;: 6.7672, &#39;eval_samples_per_second&#39;: 27.338, &#39;eval_steps_per_second&#39;: 3.547, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [08:31&lt;00:00,  1.16s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;train_runtime&#39;: 511.1208, &#39;train_samples_per_second&#39;: 13.719, &#39;train_steps_per_second&#39;: 0.861, &#39;train_loss&#39;: 0.5372205560857599, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 24/24 [00:06&lt;00:00,  3.72it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.43839508295059204, &#39;eval_accuracy&#39;: 0.7837837837837838, &#39;eval_f1&#39;: 0.8058252427184466, &#39;eval_runtime&#39;: 6.9224, &#39;eval_samples_per_second&#39;: 26.725, &#39;eval_steps_per_second&#39;: 3.467, &#39;epoch&#39;: 4.0}
------------------------- End of training
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<hr class="docutils" />
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">EPOCHS</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">TRIALS</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># We will make the trial 2 by 2 until reaching the desired number of trials</span>

<span class="c1"># let us initialize the arguments before the training function be fed</span>
<span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;epochs&#39;</span><span class="p">:</span> <span class="n">EPOCHS</span><span class="p">,</span>
        <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="n">model</span><span class="p">,</span>
        <span class="s1">&#39;trainer&#39;</span><span class="p">:</span> <span class="n">Trainer</span><span class="p">,</span>
        <span class="s1">&#39;get_datasets&#39;</span><span class="p">:</span> <span class="n">get_datasets</span><span class="p">,</span>
        <span class="s1">&#39;seed&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;metric&#39;</span><span class="p">:</span> <span class="s1">&#39;f1&#39;</span><span class="p">}</span>


<span class="c1"># let us instantiate the search function we will indicate the output dir as random kwarg initialization of the trainer</span>
<span class="n">bo_search</span> <span class="o">=</span> <span class="n">SimpleBayesianOptimizationForFakeReal</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">search_spaces</span><span class="p">,</span> <span class="n">random_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;output_dir&#39;</span><span class="p">:</span> <span class="s1">&#39;data/checkpoints/model_&#39;</span><span class="p">},</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">checkpoint</span><span class="o">=</span><span class="s1">&#39;data/trials/checkpoint_2.txt&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Checkpoint loaded at trial 4
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bo_search</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">n_trials</span><span class="o">=</span><span class="n">TRIALS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;output_dir&#39;: &#39;data/checkpoints/model_tD65Tok&#39;}
------------------------- Beginning of training
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Some weights of the model checkpoint at google/vit-base-patch16-224-in21k were not used when initializing ViTForImageClassification: [&#39;pooler.dense.weight&#39;, &#39;pooler.dense.bias&#39;]
- This IS expected if you are initializing ViTForImageClassification from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing ViTForImageClassification from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of ViTForImageClassification were not initialized from the model checkpoint at google/vit-base-patch16-224-in21k and are newly initialized: [&#39;classifier.bias&#39;, &#39;classifier.weight&#39;]
You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.
Using the `WANDB_DISABLED` environment variable is deprecated and will be removed in v5. Use the --report_to flag to control the integrations used for logging result (for instance --report_to none).
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Current Config:
 {
    &#34;lr&#34;: 8.066164211147095e-05,
    &#34;batch_size&#34;: 16,
    &#34;h_flip_p&#34;: 0.14262461447346014,
    &#34;v_flip_p&#34;: 0.34829575180008127,
    &#34;gray_scale_p&#34;: 0.365252658707733,
    &#34;rotation&#34;: 1
}
Checkpoints in data/checkpoints/model_tD65Tok
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 25%|‚ñà‚ñà‚ñå       | 110/440 [02:15&lt;05:38,  1.03s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.6867, &#39;learning_rate&#39;: 6.067955349749292e-05, &#39;epoch&#39;: 1.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 25%|‚ñà‚ñà‚ñå       | 110/440 [02:23&lt;05:38,  1.03s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.6615181565284729, &#39;eval_accuracy&#39;: 0.6054054054054054, &#39;eval_f1&#39;: 0.5730994152046783, &#39;eval_runtime&#39;: 7.5922, &#39;eval_samples_per_second&#39;: 24.367, &#39;eval_steps_per_second&#39;: 3.161, &#39;epoch&#39;: 1.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 220/440 [04:51&lt;04:45,  1.30s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.6238, &#39;learning_rate&#39;: 4.0514142969625185e-05, &#39;epoch&#39;: 2.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 220/440 [05:02&lt;04:45,  1.30s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.5714893341064453, &#39;eval_accuracy&#39;: 0.7135135135135136, &#39;eval_f1&#39;: 0.7725321888412018, &#39;eval_runtime&#39;: 10.8758, &#39;eval_samples_per_second&#39;: 17.01, &#39;eval_steps_per_second&#39;: 2.207, &#39;epoch&#39;: 2.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 330/440 [07:22&lt;01:41,  1.08it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.5172, &#39;learning_rate&#39;: 2.034873244175744e-05, &#39;epoch&#39;: 3.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 330/440 [07:29&lt;01:41,  1.08it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.5564113259315491, &#39;eval_accuracy&#39;: 0.7189189189189189, &#39;eval_f1&#39;: 0.6976744186046512, &#39;eval_runtime&#39;: 7.6249, &#39;eval_samples_per_second&#39;: 24.263, &#39;eval_steps_per_second&#39;: 3.148, &#39;epoch&#39;: 3.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [09:44&lt;00:00,  1.02s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.4272, &#39;learning_rate&#39;: 1.8332191388970669e-07, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [09:52&lt;00:00,  1.02s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.4445246458053589, &#39;eval_accuracy&#39;: 0.8, &#39;eval_f1&#39;: 0.8159203980099503, &#39;eval_runtime&#39;: 7.6549, &#39;eval_samples_per_second&#39;: 24.167, &#39;eval_steps_per_second&#39;: 3.135, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [10:03&lt;00:00,  1.37s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;train_runtime&#39;: 603.4989, &#39;train_samples_per_second&#39;: 11.619, &#39;train_steps_per_second&#39;: 0.729, &#39;train_loss&#39;: 0.5637432878667658, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 24/24 [00:07&lt;00:00,  3.39it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.4445246458053589, &#39;eval_accuracy&#39;: 0.8, &#39;eval_f1&#39;: 0.8159203980099503, &#39;eval_runtime&#39;: 7.5747, &#39;eval_samples_per_second&#39;: 24.424, &#39;eval_steps_per_second&#39;: 3.168, &#39;epoch&#39;: 4.0}
------------------------- End of training
{&#39;output_dir&#39;: &#39;data/checkpoints/model_XXErmBJ&#39;}
------------------------- Beginning of training
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Some weights of the model checkpoint at google/vit-base-patch16-224-in21k were not used when initializing ViTForImageClassification: [&#39;pooler.dense.weight&#39;, &#39;pooler.dense.bias&#39;]
- This IS expected if you are initializing ViTForImageClassification from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing ViTForImageClassification from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of ViTForImageClassification were not initialized from the model checkpoint at google/vit-base-patch16-224-in21k and are newly initialized: [&#39;classifier.bias&#39;, &#39;classifier.weight&#39;]
You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.
Using the `WANDB_DISABLED` environment variable is deprecated and will be removed in v5. Use the --report_to flag to control the integrations used for logging result (for instance --report_to none).
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Current Config:
 {
    &#34;lr&#34;: 8.627449297127138e-05,
    &#34;batch_size&#34;: 16,
    &#34;h_flip_p&#34;: 0.30186301568344553,
    &#34;v_flip_p&#34;: 0.4035641366371901,
    &#34;gray_scale_p&#34;: 0.36486589334690894,
    &#34;rotation&#34;: 1
}
Checkpoints in data/checkpoints/model_XXErmBJ
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 25%|‚ñà‚ñà‚ñå       | 110/440 [01:54&lt;04:50,  1.13it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.6739, &#39;learning_rate&#39;: 6.470586972845353e-05, &#39;epoch&#39;: 1.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 25%|‚ñà‚ñà‚ñå       | 110/440 [02:01&lt;04:50,  1.13it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.6253642439842224, &#39;eval_accuracy&#39;: 0.654054054054054, &#39;eval_f1&#39;: 0.6049382716049383, &#39;eval_runtime&#39;: 6.6478, &#39;eval_samples_per_second&#39;: 27.829, &#39;eval_steps_per_second&#39;: 3.61, &#39;epoch&#39;: 1.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 220/440 [03:57&lt;03:24,  1.08it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.5636, &#39;learning_rate&#39;: 4.313724648563569e-05, &#39;epoch&#39;: 2.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 220/440 [04:06&lt;03:24,  1.08it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.5215460658073425, &#39;eval_accuracy&#39;: 0.7243243243243244, &#39;eval_f1&#39;: 0.7753303964757708, &#39;eval_runtime&#39;: 6.9592, &#39;eval_samples_per_second&#39;: 26.583, &#39;eval_steps_per_second&#39;: 3.449, &#39;epoch&#39;: 2.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 330/440 [05:41&lt;01:19,  1.38it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.4653, &#39;learning_rate&#39;: 2.1568623242817846e-05, &#39;epoch&#39;: 3.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 330/440 [05:48&lt;01:19,  1.38it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.4547145664691925, &#39;eval_accuracy&#39;: 0.8216216216216217, &#39;eval_f1&#39;: 0.8290155440414508, &#39;eval_runtime&#39;: 6.946, &#39;eval_samples_per_second&#39;: 26.634, &#39;eval_steps_per_second&#39;: 3.455, &#39;epoch&#39;: 3.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [07:53&lt;00:00,  1.07it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.3803, &#39;learning_rate&#39;: 1.9607839311652586e-07, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [08:01&lt;00:00,  1.07it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.39084506034851074, &#39;eval_accuracy&#39;: 0.8216216216216217, &#39;eval_f1&#39;: 0.8324873096446701, &#39;eval_runtime&#39;: 7.7062, &#39;eval_samples_per_second&#39;: 24.007, &#39;eval_steps_per_second&#39;: 3.114, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [08:11&lt;00:00,  1.12s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;train_runtime&#39;: 491.5286, &#39;train_samples_per_second&#39;: 14.266, &#39;train_steps_per_second&#39;: 0.895, &#39;train_loss&#39;: 0.5208114363930442, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 24/24 [00:06&lt;00:00,  3.80it/s]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.39084506034851074, &#39;eval_accuracy&#39;: 0.8216216216216217, &#39;eval_f1&#39;: 0.8324873096446701, &#39;eval_runtime&#39;: 6.592, &#39;eval_samples_per_second&#39;: 28.064, &#39;eval_steps_per_second&#39;: 3.641, &#39;epoch&#39;: 4.0}
------------------------- End of training
</pre></div></div>
</div>
<hr class="docutils" />
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">EPOCHS</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">TRIALS</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># We will make the trial 2 by 2 until reaching the desired number of trials</span>

<span class="c1"># let us initialize the arguments before the training function be fed</span>
<span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;epochs&#39;</span><span class="p">:</span> <span class="n">EPOCHS</span><span class="p">,</span>
        <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="n">model</span><span class="p">,</span>
        <span class="s1">&#39;trainer&#39;</span><span class="p">:</span> <span class="n">Trainer</span><span class="p">,</span>
        <span class="s1">&#39;get_datasets&#39;</span><span class="p">:</span> <span class="n">get_datasets</span><span class="p">,</span>
        <span class="s1">&#39;seed&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;metric&#39;</span><span class="p">:</span> <span class="s1">&#39;f1&#39;</span><span class="p">}</span>


<span class="c1"># let us instantiate the search function we will indicate the output dir as random kwarg initialization of the trainer</span>
<span class="n">bo_search</span> <span class="o">=</span> <span class="n">SimpleBayesianOptimizationForFakeReal</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">search_spaces</span><span class="p">,</span> <span class="n">random_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;output_dir&#39;</span><span class="p">:</span> <span class="s1">&#39;data/checkpoints/model_&#39;</span><span class="p">},</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">checkpoint</span><span class="o">=</span><span class="s1">&#39;data/trials/checkpoint_2.txt&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Checkpoint loaded at trial 6
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bo_search</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">n_trials</span><span class="o">=</span><span class="n">TRIALS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;output_dir&#39;: &#39;data/checkpoints/model_HZUsA7R&#39;}
------------------------- Beginning of training
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Some weights of the model checkpoint at google/vit-base-patch16-224-in21k were not used when initializing ViTForImageClassification: [&#39;pooler.dense.weight&#39;, &#39;pooler.dense.bias&#39;]
- This IS expected if you are initializing ViTForImageClassification from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing ViTForImageClassification from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of ViTForImageClassification were not initialized from the model checkpoint at google/vit-base-patch16-224-in21k and are newly initialized: [&#39;classifier.bias&#39;, &#39;classifier.weight&#39;]
You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.
Using the `WANDB_DISABLED` environment variable is deprecated and will be removed in v5. Use the --report_to flag to control the integrations used for logging result (for instance --report_to none).
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Current Config:
 {
    &#34;lr&#34;: 6.459345257343661e-05,
    &#34;batch_size&#34;: 16,
    &#34;h_flip_p&#34;: 0.4821814530037276,
    &#34;v_flip_p&#34;: 0.4644567465010884,
    &#34;gray_scale_p&#34;: 0.37763259831790275,
    &#34;rotation&#34;: 1
}
Checkpoints in data/checkpoints/model_HZUsA7R
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 25%|‚ñà‚ñà‚ñå       | 110/440 [01:57&lt;05:19,  1.03it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.6627, &#39;learning_rate&#39;: 4.844508943007745e-05, &#39;epoch&#39;: 1.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 25%|‚ñà‚ñà‚ñå       | 110/440 [02:05&lt;05:19,  1.03it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.6089381575584412, &#39;eval_accuracy&#39;: 0.6594594594594595, &#39;eval_f1&#39;: 0.7319148936170212, &#39;eval_runtime&#39;: 6.6287, &#39;eval_samples_per_second&#39;: 27.909, &#39;eval_steps_per_second&#39;: 3.621, &#39;epoch&#39;: 1.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 220/440 [03:41&lt;02:38,  1.39it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.5424, &#39;learning_rate&#39;: 3.2296726286718304e-05, &#39;epoch&#39;: 2.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 220/440 [03:48&lt;02:38,  1.39it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.48035162687301636, &#39;eval_accuracy&#39;: 0.7837837837837838, &#39;eval_f1&#39;: 0.8058252427184466, &#39;eval_runtime&#39;: 6.6202, &#39;eval_samples_per_second&#39;: 27.945, &#39;eval_steps_per_second&#39;: 3.625, &#39;epoch&#39;: 2.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 330/440 [05:43&lt;01:57,  1.07s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.4504, &#39;learning_rate&#39;: 1.6148363143359152e-05, &#39;epoch&#39;: 3.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 330/440 [05:52&lt;01:57,  1.07s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.4704108238220215, &#39;eval_accuracy&#39;: 0.7783783783783784, &#39;eval_f1&#39;: 0.7960199004975125, &#39;eval_runtime&#39;: 8.3069, &#39;eval_samples_per_second&#39;: 22.271, &#39;eval_steps_per_second&#39;: 2.889, &#39;epoch&#39;: 3.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [08:07&lt;00:00,  1.01it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.3806, &#39;learning_rate&#39;: 0.0, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [08:15&lt;00:00,  1.01it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.4178408980369568, &#39;eval_accuracy&#39;: 0.8108108108108109, &#39;eval_f1&#39;: 0.8128342245989305, &#39;eval_runtime&#39;: 7.3348, &#39;eval_samples_per_second&#39;: 25.222, &#39;eval_steps_per_second&#39;: 3.272, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [08:26&lt;00:00,  1.15s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;train_runtime&#39;: 507.0643, &#39;train_samples_per_second&#39;: 13.829, &#39;train_steps_per_second&#39;: 0.868, &#39;train_loss&#39;: 0.5090453061190519, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 24/24 [00:06&lt;00:00,  3.62it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.4178408980369568, &#39;eval_accuracy&#39;: 0.8108108108108109, &#39;eval_f1&#39;: 0.8128342245989305, &#39;eval_runtime&#39;: 6.9437, &#39;eval_samples_per_second&#39;: 26.643, &#39;eval_steps_per_second&#39;: 3.456, &#39;epoch&#39;: 4.0}
------------------------- End of training
{&#39;output_dir&#39;: &#39;data/checkpoints/model_Db05OxY&#39;}
------------------------- Beginning of training
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Some weights of the model checkpoint at google/vit-base-patch16-224-in21k were not used when initializing ViTForImageClassification: [&#39;pooler.dense.weight&#39;, &#39;pooler.dense.bias&#39;]
- This IS expected if you are initializing ViTForImageClassification from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing ViTForImageClassification from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of ViTForImageClassification were not initialized from the model checkpoint at google/vit-base-patch16-224-in21k and are newly initialized: [&#39;classifier.bias&#39;, &#39;classifier.weight&#39;]
You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.
Using the `WANDB_DISABLED` environment variable is deprecated and will be removed in v5. Use the --report_to flag to control the integrations used for logging result (for instance --report_to none).
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Current Config:
 {
    &#34;lr&#34;: 8.627449297127138e-05,
    &#34;batch_size&#34;: 16,
    &#34;h_flip_p&#34;: 0.30186301568344553,
    &#34;v_flip_p&#34;: 0.4035641366371901,
    &#34;gray_scale_p&#34;: 0.36486589334690894,
    &#34;rotation&#34;: 1
}
Checkpoints in data/checkpoints/model_Db05OxY
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 25%|‚ñà‚ñà‚ñå       | 110/440 [01:33&lt;04:20,  1.27it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.6712, &#39;learning_rate&#39;: 6.470586972845353e-05, &#39;epoch&#39;: 1.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 25%|‚ñà‚ñà‚ñå       | 110/440 [01:39&lt;04:20,  1.27it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.6093077063560486, &#39;eval_accuracy&#39;: 0.6594594594594595, &#39;eval_f1&#39;: 0.6834170854271358, &#39;eval_runtime&#39;: 6.693, &#39;eval_samples_per_second&#39;: 27.641, &#39;eval_steps_per_second&#39;: 3.586, &#39;epoch&#39;: 1.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 220/440 [03:14&lt;02:32,  1.44it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.5604, &#39;learning_rate&#39;: 4.313724648563569e-05, &#39;epoch&#39;: 2.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 220/440 [03:21&lt;02:32,  1.44it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.5242305994033813, &#39;eval_accuracy&#39;: 0.7189189189189189, &#39;eval_f1&#39;: 0.7678571428571428, &#39;eval_runtime&#39;: 6.4055, &#39;eval_samples_per_second&#39;: 28.881, &#39;eval_steps_per_second&#39;: 3.747, &#39;epoch&#39;: 2.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 330/440 [04:55&lt;01:14,  1.47it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.4524, &#39;learning_rate&#39;: 2.1568623242817846e-05, &#39;epoch&#39;: 3.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 330/440 [05:01&lt;01:14,  1.47it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.4729231595993042, &#39;eval_accuracy&#39;: 0.7891891891891892, &#39;eval_f1&#39;: 0.7868852459016393, &#39;eval_runtime&#39;: 6.3679, &#39;eval_samples_per_second&#39;: 29.052, &#39;eval_steps_per_second&#39;: 3.769, &#39;epoch&#39;: 3.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [06:36&lt;00:00,  1.45it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.3806, &#39;learning_rate&#39;: 1.9607839311652586e-07, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [06:42&lt;00:00,  1.45it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.3955724835395813, &#39;eval_accuracy&#39;: 0.827027027027027, &#39;eval_f1&#39;: 0.8367346938775511, &#39;eval_runtime&#39;: 6.3472, &#39;eval_samples_per_second&#39;: 29.147, &#39;eval_steps_per_second&#39;: 3.781, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [06:52&lt;00:00,  1.07it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;train_runtime&#39;: 412.9509, &#39;train_samples_per_second&#39;: 16.98, &#39;train_steps_per_second&#39;: 1.066, &#39;train_loss&#39;: 0.5161731719970704, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 24/24 [00:05&lt;00:00,  4.06it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.3955724835395813, &#39;eval_accuracy&#39;: 0.827027027027027, &#39;eval_f1&#39;: 0.8367346938775511, &#39;eval_runtime&#39;: 6.1506, &#39;eval_samples_per_second&#39;: 30.078, &#39;eval_steps_per_second&#39;: 3.902, &#39;epoch&#39;: 4.0}
------------------------- End of training
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<hr class="docutils" />
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">EPOCHS</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">TRIALS</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># We will make the trial 2 by 2 until reaching the desired number of trials</span>

<span class="c1"># let us initialize the arguments before the training function be fed</span>
<span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;epochs&#39;</span><span class="p">:</span> <span class="n">EPOCHS</span><span class="p">,</span>
        <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="n">model</span><span class="p">,</span>
        <span class="s1">&#39;trainer&#39;</span><span class="p">:</span> <span class="n">Trainer</span><span class="p">,</span>
        <span class="s1">&#39;get_datasets&#39;</span><span class="p">:</span> <span class="n">get_datasets</span><span class="p">,</span>
        <span class="s1">&#39;seed&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;metric&#39;</span><span class="p">:</span> <span class="s1">&#39;f1&#39;</span><span class="p">}</span>


<span class="c1"># let us instantiate the search function we will indicate the output dir as random kwarg initialization of the trainer</span>
<span class="n">bo_search</span> <span class="o">=</span> <span class="n">SimpleBayesianOptimizationForFakeReal</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">search_spaces</span><span class="p">,</span> <span class="n">random_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;output_dir&#39;</span><span class="p">:</span> <span class="s1">&#39;data/checkpoints/model_&#39;</span><span class="p">},</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">checkpoint</span><span class="o">=</span><span class="s1">&#39;data/trials/checkpoint_2.txt&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Checkpoint loaded at trial 8
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bo_search</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">n_trials</span><span class="o">=</span><span class="n">TRIALS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;output_dir&#39;: &#39;data/checkpoints/model_qnt7qTm&#39;}
------------------------- Beginning of training
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Some weights of the model checkpoint at google/vit-base-patch16-224-in21k were not used when initializing ViTForImageClassification: [&#39;pooler.dense.weight&#39;, &#39;pooler.dense.bias&#39;]
- This IS expected if you are initializing ViTForImageClassification from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing ViTForImageClassification from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of ViTForImageClassification were not initialized from the model checkpoint at google/vit-base-patch16-224-in21k and are newly initialized: [&#39;classifier.bias&#39;, &#39;classifier.weight&#39;]
You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.
Using the `WANDB_DISABLED` environment variable is deprecated and will be removed in v5. Use the --report_to flag to control the integrations used for logging result (for instance --report_to none).
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Current Config:
 {
    &#34;lr&#34;: 6.418168561449824e-05,
    &#34;batch_size&#34;: 16,
    &#34;h_flip_p&#34;: 0.2806225314693065,
    &#34;v_flip_p&#34;: 0.35800980646120173,
    &#34;gray_scale_p&#34;: 0.35066248679511797,
    &#34;rotation&#34;: 1
}
Checkpoints in data/checkpoints/model_qnt7qTm
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 25%|‚ñà‚ñà‚ñå       | 110/440 [01:21&lt;03:35,  1.53it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.6597, &#39;learning_rate&#39;: 4.813626421087368e-05, &#39;epoch&#39;: 1.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 25%|‚ñà‚ñà‚ñå       | 110/440 [01:28&lt;03:35,  1.53it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.6085811853408813, &#39;eval_accuracy&#39;: 0.6702702702702703, &#39;eval_f1&#39;: 0.7447698744769875, &#39;eval_runtime&#39;: 6.2968, &#39;eval_samples_per_second&#39;: 29.38, &#39;eval_steps_per_second&#39;: 3.811, &#39;epoch&#39;: 1.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 220/440 [03:00&lt;02:27,  1.49it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.563, &#39;learning_rate&#39;: 3.209084280724912e-05, &#39;epoch&#39;: 2.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 220/440 [03:06&lt;02:27,  1.49it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.5332872271537781, &#39;eval_accuracy&#39;: 0.7243243243243244, &#39;eval_f1&#39;: 0.7829787234042552, &#39;eval_runtime&#39;: 6.3564, &#39;eval_samples_per_second&#39;: 29.104, &#39;eval_steps_per_second&#39;: 3.776, &#39;epoch&#39;: 2.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 330/440 [04:39&lt;01:14,  1.47it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.4671, &#39;learning_rate&#39;: 1.604542140362456e-05, &#39;epoch&#39;: 3.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 330/440 [04:46&lt;01:14,  1.47it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.4813285171985626, &#39;eval_accuracy&#39;: 0.8, &#39;eval_f1&#39;: 0.8042328042328042, &#39;eval_runtime&#39;: 6.6153, &#39;eval_samples_per_second&#39;: 27.966, &#39;eval_steps_per_second&#39;: 3.628, &#39;epoch&#39;: 3.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [06:19&lt;00:00,  1.45it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.3996, &#39;learning_rate&#39;: 0.0, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [06:25&lt;00:00,  1.45it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.42646780610084534, &#39;eval_accuracy&#39;: 0.8108108108108109, &#39;eval_f1&#39;: 0.8223350253807107, &#39;eval_runtime&#39;: 6.2809, &#39;eval_samples_per_second&#39;: 29.455, &#39;eval_steps_per_second&#39;: 3.821, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [06:35&lt;00:00,  1.11it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;train_runtime&#39;: 395.8982, &#39;train_samples_per_second&#39;: 17.712, &#39;train_steps_per_second&#39;: 1.111, &#39;train_loss&#39;: 0.5223365436900745, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 24/24 [00:06&lt;00:00,  3.87it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.42646780610084534, &#39;eval_accuracy&#39;: 0.8108108108108109, &#39;eval_f1&#39;: 0.8223350253807107, &#39;eval_runtime&#39;: 6.2385, &#39;eval_samples_per_second&#39;: 29.655, &#39;eval_steps_per_second&#39;: 3.847, &#39;epoch&#39;: 4.0}
------------------------- End of training
{&#39;output_dir&#39;: &#39;data/checkpoints/model_vUGlpSO&#39;}
------------------------- Beginning of training
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Some weights of the model checkpoint at google/vit-base-patch16-224-in21k were not used when initializing ViTForImageClassification: [&#39;pooler.dense.weight&#39;, &#39;pooler.dense.bias&#39;]
- This IS expected if you are initializing ViTForImageClassification from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing ViTForImageClassification from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of ViTForImageClassification were not initialized from the model checkpoint at google/vit-base-patch16-224-in21k and are newly initialized: [&#39;classifier.bias&#39;, &#39;classifier.weight&#39;]
You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.
Using the `WANDB_DISABLED` environment variable is deprecated and will be removed in v5. Use the --report_to flag to control the integrations used for logging result (for instance --report_to none).
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Current Config:
 {
    &#34;lr&#34;: 8.627449297127138e-05,
    &#34;batch_size&#34;: 16,
    &#34;h_flip_p&#34;: 0.30186301568344553,
    &#34;v_flip_p&#34;: 0.4035641366371901,
    &#34;gray_scale_p&#34;: 0.36486589334690894,
    &#34;rotation&#34;: 1
}
Checkpoints in data/checkpoints/model_vUGlpSO
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 25%|‚ñà‚ñà‚ñå       | 110/440 [01:22&lt;03:39,  1.51it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.6931, &#39;learning_rate&#39;: 6.470586972845353e-05, &#39;epoch&#39;: 1.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 25%|‚ñà‚ñà‚ñå       | 110/440 [01:29&lt;03:39,  1.51it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.6846270561218262, &#39;eval_accuracy&#39;: 0.5567567567567567, &#39;eval_f1&#39;: 0.6639344262295082, &#39;eval_runtime&#39;: 6.2828, &#39;eval_samples_per_second&#39;: 29.445, &#39;eval_steps_per_second&#39;: 3.82, &#39;epoch&#39;: 1.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 220/440 [03:05&lt;02:28,  1.48it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.6293, &#39;learning_rate&#39;: 4.313724648563569e-05, &#39;epoch&#39;: 2.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 220/440 [03:12&lt;02:28,  1.48it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.5758518576622009, &#39;eval_accuracy&#39;: 0.6756756756756757, &#39;eval_f1&#39;: 0.7247706422018348, &#39;eval_runtime&#39;: 6.2523, &#39;eval_samples_per_second&#39;: 29.589, &#39;eval_steps_per_second&#39;: 3.839, &#39;epoch&#39;: 2.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 330/440 [04:44&lt;01:16,  1.44it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.5383, &#39;learning_rate&#39;: 2.1568623242817846e-05, &#39;epoch&#39;: 3.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 330/440 [04:50&lt;01:16,  1.44it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.5370621681213379, &#39;eval_accuracy&#39;: 0.7027027027027027, &#39;eval_f1&#39;: 0.7058823529411764, &#39;eval_runtime&#39;: 6.4154, &#39;eval_samples_per_second&#39;: 28.837, &#39;eval_steps_per_second&#39;: 3.741, &#39;epoch&#39;: 3.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [06:23&lt;00:00,  1.52it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.4396, &#39;learning_rate&#39;: 0.0, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [06:30&lt;00:00,  1.52it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.47780826687812805, &#39;eval_accuracy&#39;: 0.7513513513513513, &#39;eval_f1&#39;: 0.7578947368421053, &#39;eval_runtime&#39;: 6.2008, &#39;eval_samples_per_second&#39;: 29.835, &#39;eval_steps_per_second&#39;: 3.87, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [06:40&lt;00:00,  1.10it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;train_runtime&#39;: 400.5351, &#39;train_samples_per_second&#39;: 17.507, &#39;train_steps_per_second&#39;: 1.099, &#39;train_loss&#39;: 0.5750896280462091, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 24/24 [00:05&lt;00:00,  4.15it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.47780826687812805, &#39;eval_accuracy&#39;: 0.7513513513513513, &#39;eval_f1&#39;: 0.7578947368421053, &#39;eval_runtime&#39;: 6.1407, &#39;eval_samples_per_second&#39;: 30.127, &#39;eval_steps_per_second&#39;: 3.908, &#39;epoch&#39;: 4.0}
------------------------- End of training
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<hr class="docutils" />
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">EPOCHS</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">TRIALS</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># We will make the trial 2 by 2 until reaching the desired number of trials</span>

<span class="c1"># let us initialize the arguments before the training function be fed</span>
<span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;epochs&#39;</span><span class="p">:</span> <span class="n">EPOCHS</span><span class="p">,</span>
        <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="n">model</span><span class="p">,</span>
        <span class="s1">&#39;trainer&#39;</span><span class="p">:</span> <span class="n">Trainer</span><span class="p">,</span>
        <span class="s1">&#39;get_datasets&#39;</span><span class="p">:</span> <span class="n">get_datasets</span><span class="p">,</span>
        <span class="s1">&#39;seed&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;metric&#39;</span><span class="p">:</span> <span class="s1">&#39;f1&#39;</span><span class="p">}</span>


<span class="c1"># let us instantiate the search function we will indicate the output dir as random kwarg initialization of the trainer</span>
<span class="n">bo_search</span> <span class="o">=</span> <span class="n">SimpleBayesianOptimizationForFakeReal</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">search_spaces</span><span class="p">,</span> <span class="n">random_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;output_dir&#39;</span><span class="p">:</span> <span class="s1">&#39;data/checkpoints/model_&#39;</span><span class="p">},</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">checkpoint</span><span class="o">=</span><span class="s1">&#39;data/trials/checkpoint_2.txt&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Checkpoint loaded at trial 10
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bo_search</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">n_trials</span><span class="o">=</span><span class="n">TRIALS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;output_dir&#39;: &#39;data/checkpoints/model_XsNJh3e&#39;}
------------------------- Beginning of training
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Some weights of the model checkpoint at google/vit-base-patch16-224-in21k were not used when initializing ViTForImageClassification: [&#39;pooler.dense.weight&#39;, &#39;pooler.dense.bias&#39;]
- This IS expected if you are initializing ViTForImageClassification from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing ViTForImageClassification from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of ViTForImageClassification were not initialized from the model checkpoint at google/vit-base-patch16-224-in21k and are newly initialized: [&#39;classifier.bias&#39;, &#39;classifier.weight&#39;]
You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.
Using the `WANDB_DISABLED` environment variable is deprecated and will be removed in v5. Use the --report_to flag to control the integrations used for logging result (for instance --report_to none).
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Current Config:
 {
    &#34;lr&#34;: 5.08069272131592e-05,
    &#34;batch_size&#34;: 16,
    &#34;h_flip_p&#34;: 0.41705521332037515,
    &#34;v_flip_p&#34;: 0.0813270485780424,
    &#34;gray_scale_p&#34;: 0.17763535011376075,
    &#34;rotation&#34;: 1
}
Checkpoints in data/checkpoints/model_XsNJh3e
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 25%|‚ñà‚ñà‚ñå       | 110/440 [01:36&lt;04:43,  1.16it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.6637, &#39;learning_rate&#39;: 3.81051954098694e-05, &#39;epoch&#39;: 1.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 25%|‚ñà‚ñà‚ñå       | 110/440 [01:44&lt;04:43,  1.16it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.5799012780189514, &#39;eval_accuracy&#39;: 0.7243243243243244, &#39;eval_f1&#39;: 0.7487684729064038, &#39;eval_runtime&#39;: 7.2527, &#39;eval_samples_per_second&#39;: 25.508, &#39;eval_steps_per_second&#39;: 3.309, &#39;epoch&#39;: 1.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 220/440 [03:13&lt;02:21,  1.56it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.5224, &#39;learning_rate&#39;: 2.54034636065796e-05, &#39;epoch&#39;: 2.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 220/440 [03:20&lt;02:21,  1.56it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.4676978886127472, &#39;eval_accuracy&#39;: 0.772972972972973, &#39;eval_f1&#39;: 0.7741935483870968, &#39;eval_runtime&#39;: 6.3761, &#39;eval_samples_per_second&#39;: 29.014, &#39;eval_steps_per_second&#39;: 3.764, &#39;epoch&#39;: 2.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 330/440 [04:52&lt;01:13,  1.50it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.4152, &#39;learning_rate&#39;: 1.2817202092410616e-05, &#39;epoch&#39;: 3.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 330/440 [04:58&lt;01:13,  1.50it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.41337791085243225, &#39;eval_accuracy&#39;: 0.827027027027027, &#39;eval_f1&#39;: 0.8297872340425533, &#39;eval_runtime&#39;: 6.4751, &#39;eval_samples_per_second&#39;: 28.571, &#39;eval_steps_per_second&#39;: 3.707, &#39;epoch&#39;: 3.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [06:30&lt;00:00,  1.53it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.3283, &#39;learning_rate&#39;: 1.1547028912081635e-07, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [06:37&lt;00:00,  1.53it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.3873978853225708, &#39;eval_accuracy&#39;: 0.8378378378378378, &#39;eval_f1&#39;: 0.8387096774193548, &#39;eval_runtime&#39;: 6.4884, &#39;eval_samples_per_second&#39;: 28.512, &#39;eval_steps_per_second&#39;: 3.699, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [06:47&lt;00:00,  1.08it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;train_runtime&#39;: 407.7754, &#39;train_samples_per_second&#39;: 17.196, &#39;train_steps_per_second&#39;: 1.079, &#39;train_loss&#39;: 0.4824158408425071, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 24/24 [00:06&lt;00:00,  3.90it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.3873978853225708, &#39;eval_accuracy&#39;: 0.8378378378378378, &#39;eval_f1&#39;: 0.8387096774193548, &#39;eval_runtime&#39;: 6.4868, &#39;eval_samples_per_second&#39;: 28.52, &#39;eval_steps_per_second&#39;: 3.7, &#39;epoch&#39;: 4.0}
------------------------- End of training
{&#39;output_dir&#39;: &#39;data/checkpoints/model_sdsOrrB&#39;}
------------------------- Beginning of training
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Some weights of the model checkpoint at google/vit-base-patch16-224-in21k were not used when initializing ViTForImageClassification: [&#39;pooler.dense.weight&#39;, &#39;pooler.dense.bias&#39;]
- This IS expected if you are initializing ViTForImageClassification from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing ViTForImageClassification from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of ViTForImageClassification were not initialized from the model checkpoint at google/vit-base-patch16-224-in21k and are newly initialized: [&#39;classifier.bias&#39;, &#39;classifier.weight&#39;]
You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.
Using the `WANDB_DISABLED` environment variable is deprecated and will be removed in v5. Use the --report_to flag to control the integrations used for logging result (for instance --report_to none).
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Current Config:
 {
    &#34;lr&#34;: 1.638937774081293e-05,
    &#34;batch_size&#34;: 16,
    &#34;h_flip_p&#34;: 0.31555147863504945,
    &#34;v_flip_p&#34;: 0.11447089190557719,
    &#34;gray_scale_p&#34;: 0.452710006503064,
    &#34;rotation&#34;: 1
}
Checkpoints in data/checkpoints/model_sdsOrrB
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 25%|‚ñà‚ñà‚ñå       | 110/440 [01:24&lt;03:40,  1.50it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.6838, &#39;learning_rate&#39;: 1.2292033305609696e-05, &#39;epoch&#39;: 1.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 25%|‚ñà‚ñà‚ñå       | 110/440 [01:30&lt;03:40,  1.50it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.6577768921852112, &#39;eval_accuracy&#39;: 0.6702702702702703, &#39;eval_f1&#39;: 0.6772486772486773, &#39;eval_runtime&#39;: 6.4004, &#39;eval_samples_per_second&#39;: 28.904, &#39;eval_steps_per_second&#39;: 3.75, &#39;epoch&#39;: 1.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 220/440 [03:05&lt;02:27,  1.49it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.6152, &#39;learning_rate&#39;: 8.194688870406464e-06, &#39;epoch&#39;: 2.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 220/440 [03:11&lt;02:27,  1.49it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.596728503704071, &#39;eval_accuracy&#39;: 0.7243243243243244, &#39;eval_f1&#39;: 0.7713004484304932, &#39;eval_runtime&#39;: 6.2379, &#39;eval_samples_per_second&#39;: 29.657, &#39;eval_steps_per_second&#39;: 3.847, &#39;epoch&#39;: 2.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 330/440 [04:44&lt;01:15,  1.47it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.5612, &#39;learning_rate&#39;: 4.134593020977807e-06, &#39;epoch&#39;: 3.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 330/440 [04:51&lt;01:15,  1.47it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.5475757718086243, &#39;eval_accuracy&#39;: 0.7567567567567568, &#39;eval_f1&#39;: 0.7593582887700534, &#39;eval_runtime&#39;: 6.368, &#39;eval_samples_per_second&#39;: 29.052, &#39;eval_steps_per_second&#39;: 3.769, &#39;epoch&#39;: 3.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [06:25&lt;00:00,  1.45it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.5199, &#39;learning_rate&#39;: 3.724858577457483e-08, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [06:31&lt;00:00,  1.45it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.5319870114326477, &#39;eval_accuracy&#39;: 0.745945945945946, &#39;eval_f1&#39;: 0.7539267015706805, &#39;eval_runtime&#39;: 6.3274, &#39;eval_samples_per_second&#39;: 29.238, &#39;eval_steps_per_second&#39;: 3.793, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [06:41&lt;00:00,  1.09it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;train_runtime&#39;: 402.1036, &#39;train_samples_per_second&#39;: 17.438, &#39;train_steps_per_second&#39;: 1.094, &#39;train_loss&#39;: 0.5950130289251154, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 24/24 [00:06&lt;00:00,  3.90it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.5319870114326477, &#39;eval_accuracy&#39;: 0.745945945945946, &#39;eval_f1&#39;: 0.7539267015706805, &#39;eval_runtime&#39;: 6.5434, &#39;eval_samples_per_second&#39;: 28.273, &#39;eval_steps_per_second&#39;: 3.668, &#39;epoch&#39;: 4.0}
------------------------- End of training
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<hr class="docutils" />
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">EPOCHS</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">TRIALS</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># We will make the trial 2 by 2 until reaching the desired number of trials</span>

<span class="c1"># let us initialize the arguments before the training function be fed</span>
<span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;epochs&#39;</span><span class="p">:</span> <span class="n">EPOCHS</span><span class="p">,</span>
        <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="n">model</span><span class="p">,</span>
        <span class="s1">&#39;trainer&#39;</span><span class="p">:</span> <span class="n">Trainer</span><span class="p">,</span>
        <span class="s1">&#39;get_datasets&#39;</span><span class="p">:</span> <span class="n">get_datasets</span><span class="p">,</span>
        <span class="s1">&#39;seed&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;metric&#39;</span><span class="p">:</span> <span class="s1">&#39;f1&#39;</span><span class="p">}</span>


<span class="c1"># let us instantiate the search function we will indicate the output dir as random kwarg initialization of the trainer</span>
<span class="n">bo_search</span> <span class="o">=</span> <span class="n">SimpleBayesianOptimizationForFakeReal</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">search_spaces</span><span class="p">,</span> <span class="n">random_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;output_dir&#39;</span><span class="p">:</span> <span class="s1">&#39;data/checkpoints/model_&#39;</span><span class="p">},</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">checkpoint</span><span class="o">=</span><span class="s1">&#39;data/trials/checkpoint_2.txt&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Checkpoint loaded at trial 12
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bo_search</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">n_trials</span><span class="o">=</span><span class="n">TRIALS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;output_dir&#39;: &#39;data/checkpoints/model_KxxdKWh&#39;}
------------------------- Beginning of training
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Some weights of the model checkpoint at google/vit-base-patch16-224-in21k were not used when initializing ViTForImageClassification: [&#39;pooler.dense.weight&#39;, &#39;pooler.dense.bias&#39;]
- This IS expected if you are initializing ViTForImageClassification from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing ViTForImageClassification from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of ViTForImageClassification were not initialized from the model checkpoint at google/vit-base-patch16-224-in21k and are newly initialized: [&#39;classifier.bias&#39;, &#39;classifier.weight&#39;]
You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.
Using the `WANDB_DISABLED` environment variable is deprecated and will be removed in v5. Use the --report_to flag to control the integrations used for logging result (for instance --report_to none).
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Current Config:
 {
    &#34;lr&#34;: 1.6166919943341313e-05,
    &#34;batch_size&#34;: 16,
    &#34;h_flip_p&#34;: 0.03398043168787862,
    &#34;v_flip_p&#34;: 0.4309096009850647,
    &#34;gray_scale_p&#34;: 0.20188777565913874,
    &#34;rotation&#34;: 1
}
Checkpoints in data/checkpoints/model_KxxdKWh
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 25%|‚ñà‚ñà‚ñå       | 110/440 [01:22&lt;03:35,  1.53it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.6814, &#39;learning_rate&#39;: 1.2125189957505985e-05, &#39;epoch&#39;: 1.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 25%|‚ñà‚ñà‚ñå       | 110/440 [01:28&lt;03:35,  1.53it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.6544196009635925, &#39;eval_accuracy&#39;: 0.6864864864864865, &#39;eval_f1&#39;: 0.7314814814814814, &#39;eval_runtime&#39;: 6.2203, &#39;eval_samples_per_second&#39;: 29.741, &#39;eval_steps_per_second&#39;: 3.858, &#39;epoch&#39;: 1.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 220/440 [02:59&lt;02:23,  1.53it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.5957, &#39;learning_rate&#39;: 8.083459971670656e-06, &#39;epoch&#39;: 2.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 220/440 [03:05&lt;02:23,  1.53it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.591998815536499, &#39;eval_accuracy&#39;: 0.7189189189189189, &#39;eval_f1&#39;: 0.7678571428571428, &#39;eval_runtime&#39;: 6.31, &#39;eval_samples_per_second&#39;: 29.319, &#39;eval_steps_per_second&#39;: 3.804, &#39;epoch&#39;: 2.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 330/440 [04:36&lt;01:12,  1.52it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.5249, &#39;learning_rate&#39;: 4.041729985835328e-06, &#39;epoch&#39;: 3.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 330/440 [04:42&lt;01:12,  1.52it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.5300708413124084, &#39;eval_accuracy&#39;: 0.7675675675675676, &#39;eval_f1&#39;: 0.7860696517412936, &#39;eval_runtime&#39;: 6.2027, &#39;eval_samples_per_second&#39;: 29.825, &#39;eval_steps_per_second&#39;: 3.869, &#39;epoch&#39;: 3.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [06:17&lt;00:00,  1.54it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.4784, &#39;learning_rate&#39;: 3.674299987123025e-08, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [06:24&lt;00:00,  1.54it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.5100064873695374, &#39;eval_accuracy&#39;: 0.772972972972973, &#39;eval_f1&#39;: 0.7765957446808511, &#39;eval_runtime&#39;: 6.2552, &#39;eval_samples_per_second&#39;: 29.576, &#39;eval_steps_per_second&#39;: 3.837, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [06:35&lt;00:00,  1.11it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;train_runtime&#39;: 395.4215, &#39;train_samples_per_second&#39;: 17.733, &#39;train_steps_per_second&#39;: 1.113, &#39;train_loss&#39;: 0.5700991283763539, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 24/24 [00:05&lt;00:00,  4.15it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.5100064873695374, &#39;eval_accuracy&#39;: 0.772972972972973, &#39;eval_f1&#39;: 0.7765957446808511, &#39;eval_runtime&#39;: 6.1599, &#39;eval_samples_per_second&#39;: 30.033, &#39;eval_steps_per_second&#39;: 3.896, &#39;epoch&#39;: 4.0}
------------------------- End of training
{&#39;output_dir&#39;: &#39;data/checkpoints/model_TE6bQiN&#39;}
------------------------- Beginning of training
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Some weights of the model checkpoint at google/vit-base-patch16-224-in21k were not used when initializing ViTForImageClassification: [&#39;pooler.dense.weight&#39;, &#39;pooler.dense.bias&#39;]
- This IS expected if you are initializing ViTForImageClassification from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing ViTForImageClassification from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of ViTForImageClassification were not initialized from the model checkpoint at google/vit-base-patch16-224-in21k and are newly initialized: [&#39;classifier.bias&#39;, &#39;classifier.weight&#39;]
You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.
Using the `WANDB_DISABLED` environment variable is deprecated and will be removed in v5. Use the --report_to flag to control the integrations used for logging result (for instance --report_to none).
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Current Config:
 {
    &#34;lr&#34;: 2.810359570507263e-05,
    &#34;batch_size&#34;: 16,
    &#34;h_flip_p&#34;: 0.15585814565044748,
    &#34;v_flip_p&#34;: 0.49757467833044733,
    &#34;gray_scale_p&#34;: 0.32493902881972675,
    &#34;rotation&#34;: 1
}
Checkpoints in data/checkpoints/model_TE6bQiN
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 25%|‚ñà‚ñà‚ñå       | 110/440 [01:29&lt;03:33,  1.55it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.6748, &#39;learning_rate&#39;: 2.1077696778804473e-05, &#39;epoch&#39;: 1.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 25%|‚ñà‚ñà‚ñå       | 110/440 [01:36&lt;03:33,  1.55it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.6398054957389832, &#39;eval_accuracy&#39;: 0.654054054054054, &#39;eval_f1&#39;: 0.7355371900826447, &#39;eval_runtime&#39;: 7.0883, &#39;eval_samples_per_second&#39;: 26.099, &#39;eval_steps_per_second&#39;: 3.386, &#39;epoch&#39;: 1.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 220/440 [03:17&lt;02:59,  1.23it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.5657, &#39;learning_rate&#39;: 1.4051797852536315e-05, &#39;epoch&#39;: 2.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 220/440 [03:24&lt;02:59,  1.23it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.517016589641571, &#39;eval_accuracy&#39;: 0.772972972972973, &#39;eval_f1&#39;: 0.8018867924528301, &#39;eval_runtime&#39;: 7.8123, &#39;eval_samples_per_second&#39;: 23.681, &#39;eval_steps_per_second&#39;: 3.072, &#39;epoch&#39;: 2.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 330/440 [05:03&lt;01:26,  1.27it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.4869, &#39;learning_rate&#39;: 7.0258989262681576e-06, &#39;epoch&#39;: 3.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 330/440 [05:09&lt;01:26,  1.27it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.4961181581020355, &#39;eval_accuracy&#39;: 0.772972972972973, &#39;eval_f1&#39;: 0.7717391304347825, &#39;eval_runtime&#39;: 6.53, &#39;eval_samples_per_second&#39;: 28.331, &#39;eval_steps_per_second&#39;: 3.675, &#39;epoch&#39;: 3.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [06:52&lt;00:00,  1.33it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.4395, &#39;learning_rate&#39;: 6.387180842061962e-08, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [06:58&lt;00:00,  1.33it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.4600895941257477, &#39;eval_accuracy&#39;: 0.7891891891891892, &#39;eval_f1&#39;: 0.8, &#39;eval_runtime&#39;: 6.2404, &#39;eval_samples_per_second&#39;: 29.646, &#39;eval_steps_per_second&#39;: 3.846, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [07:08&lt;00:00,  1.03it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;train_runtime&#39;: 428.7112, &#39;train_samples_per_second&#39;: 16.356, &#39;train_steps_per_second&#39;: 1.026, &#39;train_loss&#39;: 0.5417569333856757, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 24/24 [00:05&lt;00:00,  4.08it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.4600895941257477, &#39;eval_accuracy&#39;: 0.7891891891891892, &#39;eval_f1&#39;: 0.8, &#39;eval_runtime&#39;: 6.1238, &#39;eval_samples_per_second&#39;: 30.21, &#39;eval_steps_per_second&#39;: 3.919, &#39;epoch&#39;: 4.0}
------------------------- End of training
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<hr class="docutils" />
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">EPOCHS</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">TRIALS</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># We will make the trial 2 by 2 until reaching the desired number of trials</span>

<span class="c1"># let us initialize the arguments before the training function be fed</span>
<span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;epochs&#39;</span><span class="p">:</span> <span class="n">EPOCHS</span><span class="p">,</span>
        <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="n">model</span><span class="p">,</span>
        <span class="s1">&#39;trainer&#39;</span><span class="p">:</span> <span class="n">Trainer</span><span class="p">,</span>
        <span class="s1">&#39;get_datasets&#39;</span><span class="p">:</span> <span class="n">get_datasets</span><span class="p">,</span>
        <span class="s1">&#39;seed&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;metric&#39;</span><span class="p">:</span> <span class="s1">&#39;f1&#39;</span><span class="p">}</span>


<span class="c1"># let us instantiate the search function we will indicate the output dir as random kwarg initialization of the trainer</span>
<span class="n">bo_search</span> <span class="o">=</span> <span class="n">SimpleBayesianOptimizationForFakeReal</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">search_spaces</span><span class="p">,</span> <span class="n">random_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;output_dir&#39;</span><span class="p">:</span> <span class="s1">&#39;data/checkpoints/model_&#39;</span><span class="p">},</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">checkpoint</span><span class="o">=</span><span class="s1">&#39;data/trials/checkpoint_2.txt&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Checkpoint loaded at trial 14
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bo_search</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">n_trials</span><span class="o">=</span><span class="n">TRIALS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;output_dir&#39;: &#39;data/checkpoints/model_Tr1WYDq&#39;}
------------------------- Beginning of training
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Some weights of the model checkpoint at google/vit-base-patch16-224-in21k were not used when initializing ViTForImageClassification: [&#39;pooler.dense.weight&#39;, &#39;pooler.dense.bias&#39;]
- This IS expected if you are initializing ViTForImageClassification from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing ViTForImageClassification from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of ViTForImageClassification were not initialized from the model checkpoint at google/vit-base-patch16-224-in21k and are newly initialized: [&#39;classifier.bias&#39;, &#39;classifier.weight&#39;]
You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.
Using the `WANDB_DISABLED` environment variable is deprecated and will be removed in v5. Use the --report_to flag to control the integrations used for logging result (for instance --report_to none).
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Current Config:
 {
    &#34;lr&#34;: 7.829266304167906e-05,
    &#34;batch_size&#34;: 16,
    &#34;h_flip_p&#34;: 0.07982965818844506,
    &#34;v_flip_p&#34;: 0.21130719907675127,
    &#34;gray_scale_p&#34;: 0.13893567083582092,
    &#34;rotation&#34;: 1
}
Checkpoints in data/checkpoints/model_Tr1WYDq
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 25%|‚ñà‚ñà‚ñå       | 110/440 [01:27&lt;04:14,  1.30it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.6535, &#39;learning_rate&#39;: 5.8719497281259293e-05, &#39;epoch&#39;: 1.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 25%|‚ñà‚ñà‚ñå       | 110/440 [01:34&lt;04:14,  1.30it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.5823829174041748, &#39;eval_accuracy&#39;: 0.7189189189189189, &#39;eval_f1&#39;: 0.74, &#39;eval_runtime&#39;: 6.9176, &#39;eval_samples_per_second&#39;: 26.744, &#39;eval_steps_per_second&#39;: 3.469, &#39;epoch&#39;: 1.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 220/440 [03:13&lt;02:31,  1.45it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.4891, &#39;learning_rate&#39;: 3.914633152083953e-05, &#39;epoch&#39;: 2.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 220/440 [03:20&lt;02:31,  1.45it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.6287944316864014, &#39;eval_accuracy&#39;: 0.6972972972972973, &#39;eval_f1&#39;: 0.776, &#39;eval_runtime&#39;: 6.5131, &#39;eval_samples_per_second&#39;: 28.404, &#39;eval_steps_per_second&#39;: 3.685, &#39;epoch&#39;: 2.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 330/440 [04:58&lt;01:14,  1.49it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.3836, &#39;learning_rate&#39;: 1.9751103630969035e-05, &#39;epoch&#39;: 3.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 330/440 [05:05&lt;01:14,  1.49it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.4509148597717285, &#39;eval_accuracy&#39;: 0.7837837837837838, &#39;eval_f1&#39;: 0.7802197802197802, &#39;eval_runtime&#39;: 6.7507, &#39;eval_samples_per_second&#39;: 27.404, &#39;eval_steps_per_second&#39;: 3.555, &#39;epoch&#39;: 3.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [06:53&lt;00:00,  1.20s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.2939, &#39;learning_rate&#39;: 1.7793787054927058e-07, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [07:03&lt;00:00,  1.20s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.3941675126552582, &#39;eval_accuracy&#39;: 0.827027027027027, &#39;eval_f1&#39;: 0.8315789473684211, &#39;eval_runtime&#39;: 9.7935, &#39;eval_samples_per_second&#39;: 18.89, &#39;eval_steps_per_second&#39;: 2.451, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [07:19&lt;00:00,  1.00it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;train_runtime&#39;: 439.4248, &#39;train_samples_per_second&#39;: 15.957, &#39;train_steps_per_second&#39;: 1.001, &#39;train_loss&#39;: 0.4550192746249112, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 24/24 [00:08&lt;00:00,  2.84it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.3941675126552582, &#39;eval_accuracy&#39;: 0.827027027027027, &#39;eval_f1&#39;: 0.8315789473684211, &#39;eval_runtime&#39;: 8.9407, &#39;eval_samples_per_second&#39;: 20.692, &#39;eval_steps_per_second&#39;: 2.684, &#39;epoch&#39;: 4.0}
------------------------- End of training
{&#39;output_dir&#39;: &#39;data/checkpoints/model_m2YJCcb&#39;}
------------------------- Beginning of training
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Some weights of the model checkpoint at google/vit-base-patch16-224-in21k were not used when initializing ViTForImageClassification: [&#39;pooler.dense.weight&#39;, &#39;pooler.dense.bias&#39;]
- This IS expected if you are initializing ViTForImageClassification from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing ViTForImageClassification from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of ViTForImageClassification were not initialized from the model checkpoint at google/vit-base-patch16-224-in21k and are newly initialized: [&#39;classifier.bias&#39;, &#39;classifier.weight&#39;]
You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.
Using the `WANDB_DISABLED` environment variable is deprecated and will be removed in v5. Use the --report_to flag to control the integrations used for logging result (for instance --report_to none).
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Current Config:
 {
    &#34;lr&#34;: 6.721159998379602e-05,
    &#34;batch_size&#34;: 16,
    &#34;h_flip_p&#34;: 0.18241608948504212,
    &#34;v_flip_p&#34;: 0.18509048355844132,
    &#34;gray_scale_p&#34;: 0.10475351538574385,
    &#34;rotation&#34;: 1
}
Checkpoints in data/checkpoints/model_m2YJCcb
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 25%|‚ñà‚ñà‚ñå       | 110/440 [02:06&lt;05:31,  1.00s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.6361, &#39;learning_rate&#39;: 5.040869998784702e-05, &#39;epoch&#39;: 1.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 25%|‚ñà‚ñà‚ñå       | 110/440 [02:13&lt;05:31,  1.00s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.5257845520973206, &#39;eval_accuracy&#39;: 0.7405405405405405, &#39;eval_f1&#39;: 0.7499999999999999, &#39;eval_runtime&#39;: 7.0262, &#39;eval_samples_per_second&#39;: 26.33, &#39;eval_steps_per_second&#39;: 3.416, &#39;epoch&#39;: 1.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 220/440 [04:21&lt;04:01,  1.10s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.5037, &#39;learning_rate&#39;: 3.3758553628224825e-05, &#39;epoch&#39;: 2.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 220/440 [04:29&lt;04:01,  1.10s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.4549715518951416, &#39;eval_accuracy&#39;: 0.7891891891891892, &#39;eval_f1&#39;: 0.8186046511627907, &#39;eval_runtime&#39;: 7.7111, &#39;eval_samples_per_second&#39;: 23.991, &#39;eval_steps_per_second&#39;: 3.112, &#39;epoch&#39;: 2.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 330/440 [06:36&lt;01:43,  1.06it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.3809, &#39;learning_rate&#39;: 1.6955653632275813e-05, &#39;epoch&#39;: 3.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 330/440 [06:43&lt;01:43,  1.06it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.44288891553878784, &#39;eval_accuracy&#39;: 0.8108108108108109, &#39;eval_f1&#39;: 0.7953216374269005, &#39;eval_runtime&#39;: 7.2141, &#39;eval_samples_per_second&#39;: 25.644, &#39;eval_steps_per_second&#39;: 3.327, &#39;epoch&#39;: 3.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [08:26&lt;00:00,  1.06s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.3028, &#39;learning_rate&#39;: 1.5275363632680913e-07, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [08:35&lt;00:00,  1.06s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.35217583179473877, &#39;eval_accuracy&#39;: 0.8594594594594595, &#39;eval_f1&#39;: 0.8659793814432989, &#39;eval_runtime&#39;: 8.9829, &#39;eval_samples_per_second&#39;: 20.595, &#39;eval_steps_per_second&#39;: 2.672, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [08:50&lt;00:00,  1.20s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;train_runtime&#39;: 530.346, &#39;train_samples_per_second&#39;: 13.222, &#39;train_steps_per_second&#39;: 0.83, &#39;train_loss&#39;: 0.45588083267211915, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 24/24 [00:07&lt;00:00,  3.16it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.35217583179473877, &#39;eval_accuracy&#39;: 0.8594594594594595, &#39;eval_f1&#39;: 0.8659793814432989, &#39;eval_runtime&#39;: 8.432, &#39;eval_samples_per_second&#39;: 21.94, &#39;eval_steps_per_second&#39;: 2.846, &#39;epoch&#39;: 4.0}
------------------------- End of training
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<hr class="docutils" />
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">EPOCHS</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">TRIALS</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># We will make the trial 2 by 2 until reaching the desired number of trials</span>

<span class="c1"># let us initialize the arguments before the training function be fed</span>
<span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;epochs&#39;</span><span class="p">:</span> <span class="n">EPOCHS</span><span class="p">,</span>
        <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="n">model</span><span class="p">,</span>
        <span class="s1">&#39;trainer&#39;</span><span class="p">:</span> <span class="n">Trainer</span><span class="p">,</span>
        <span class="s1">&#39;get_datasets&#39;</span><span class="p">:</span> <span class="n">get_datasets</span><span class="p">,</span>
        <span class="s1">&#39;seed&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;metric&#39;</span><span class="p">:</span> <span class="s1">&#39;f1&#39;</span><span class="p">}</span>


<span class="c1"># let us instantiate the search function we will indicate the output dir as random kwarg initialization of the trainer</span>
<span class="n">bo_search</span> <span class="o">=</span> <span class="n">SimpleBayesianOptimizationForFakeReal</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">search_spaces</span><span class="p">,</span> <span class="n">random_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;output_dir&#39;</span><span class="p">:</span> <span class="s1">&#39;data/checkpoints/model_&#39;</span><span class="p">},</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">checkpoint</span><span class="o">=</span><span class="s1">&#39;data/trials/checkpoint_2.txt&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Checkpoint loaded at trial 16
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bo_search</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">n_trials</span><span class="o">=</span><span class="n">TRIALS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;output_dir&#39;: &#39;data/checkpoints/model_5yTGwaH&#39;}
------------------------- Beginning of training
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Some weights of the model checkpoint at google/vit-base-patch16-224-in21k were not used when initializing ViTForImageClassification: [&#39;pooler.dense.weight&#39;, &#39;pooler.dense.bias&#39;]
- This IS expected if you are initializing ViTForImageClassification from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing ViTForImageClassification from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of ViTForImageClassification were not initialized from the model checkpoint at google/vit-base-patch16-224-in21k and are newly initialized: [&#39;classifier.bias&#39;, &#39;classifier.weight&#39;]
You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.
Using the `WANDB_DISABLED` environment variable is deprecated and will be removed in v5. Use the --report_to flag to control the integrations used for logging result (for instance --report_to none).
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Current Config:
 {
    &#34;lr&#34;: 1.064717550865842e-05,
    &#34;batch_size&#34;: 16,
    &#34;h_flip_p&#34;: 0.35392047327422704,
    &#34;v_flip_p&#34;: 0.0294368834381617,
    &#34;gray_scale_p&#34;: 0.03370016405515375,
    &#34;rotation&#34;: 1
}
Checkpoints in data/checkpoints/model_5yTGwaH
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 25%|‚ñà‚ñà‚ñå       | 110/440 [01:52&lt;05:32,  1.01s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.6827, &#39;learning_rate&#39;: 7.985381631493814e-06, &#39;epoch&#39;: 1.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 25%|‚ñà‚ñà‚ñå       | 110/440 [01:59&lt;05:32,  1.01s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.6621648073196411, &#39;eval_accuracy&#39;: 0.6702702702702703, &#39;eval_f1&#39;: 0.6903553299492386, &#39;eval_runtime&#39;: 7.4817, &#39;eval_samples_per_second&#39;: 24.727, &#39;eval_steps_per_second&#39;: 3.208, &#39;epoch&#39;: 1.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 220/440 [03:41&lt;02:49,  1.30it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.6104, &#39;learning_rate&#39;: 5.32358775432921e-06, &#39;epoch&#39;: 2.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 220/440 [03:48&lt;02:49,  1.30it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.5968446731567383, &#39;eval_accuracy&#39;: 0.745945945945946, &#39;eval_f1&#39;: 0.779342723004695, &#39;eval_runtime&#39;: 6.7382, &#39;eval_samples_per_second&#39;: 27.456, &#39;eval_steps_per_second&#39;: 3.562, &#39;epoch&#39;: 2.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 330/440 [05:55&lt;01:47,  1.03it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.5215, &#39;learning_rate&#39;: 2.6859920033206465e-06, &#39;epoch&#39;: 3.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 330/440 [06:04&lt;01:47,  1.03it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.5354386568069458, &#39;eval_accuracy&#39;: 0.7621621621621621, &#39;eval_f1&#39;: 0.7582417582417582, &#39;eval_runtime&#39;: 8.2766, &#39;eval_samples_per_second&#39;: 22.352, &#39;eval_steps_per_second&#39;: 2.9, &#39;epoch&#39;: 3.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [08:13&lt;00:00,  1.03s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.4776, &#39;learning_rate&#39;: 2.4198126156041862e-08, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [08:22&lt;00:00,  1.03s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.5194897055625916, &#39;eval_accuracy&#39;: 0.7891891891891892, &#39;eval_f1&#39;: 0.7958115183246073, &#39;eval_runtime&#39;: 8.4101, &#39;eval_samples_per_second&#39;: 21.997, &#39;eval_steps_per_second&#39;: 2.854, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [08:37&lt;00:00,  1.18s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;train_runtime&#39;: 517.3739, &#39;train_samples_per_second&#39;: 13.553, &#39;train_steps_per_second&#39;: 0.85, &#39;train_loss&#39;: 0.573041465065696, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 24/24 [00:07&lt;00:00,  3.14it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.5194897055625916, &#39;eval_accuracy&#39;: 0.7891891891891892, &#39;eval_f1&#39;: 0.7958115183246073, &#39;eval_runtime&#39;: 8.2602, &#39;eval_samples_per_second&#39;: 22.397, &#39;eval_steps_per_second&#39;: 2.905, &#39;epoch&#39;: 4.0}
------------------------- End of training
{&#39;output_dir&#39;: &#39;data/checkpoints/model_KdPzwzc&#39;}
------------------------- Beginning of training
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Some weights of the model checkpoint at google/vit-base-patch16-224-in21k were not used when initializing ViTForImageClassification: [&#39;pooler.dense.weight&#39;, &#39;pooler.dense.bias&#39;]
- This IS expected if you are initializing ViTForImageClassification from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing ViTForImageClassification from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of ViTForImageClassification were not initialized from the model checkpoint at google/vit-base-patch16-224-in21k and are newly initialized: [&#39;classifier.bias&#39;, &#39;classifier.weight&#39;]
You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.
Using the `WANDB_DISABLED` environment variable is deprecated and will be removed in v5. Use the --report_to flag to control the integrations used for logging result (for instance --report_to none).
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Current Config:
 {
    &#34;lr&#34;: 2.4168945514553496e-05,
    &#34;batch_size&#34;: 16,
    &#34;h_flip_p&#34;: 0.4803894516372252,
    &#34;v_flip_p&#34;: 0.04005573262029344,
    &#34;gray_scale_p&#34;: 0.0929124804903616,
    &#34;rotation&#34;: 1
}
Checkpoints in data/checkpoints/model_KdPzwzc
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 25%|‚ñà‚ñà‚ñå       | 110/440 [02:13&lt;05:18,  1.03it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.6618, &#39;learning_rate&#39;: 1.8126709135915122e-05, &#39;epoch&#39;: 1.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 25%|‚ñà‚ñà‚ñå       | 110/440 [02:22&lt;05:18,  1.03it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.5947107076644897, &#39;eval_accuracy&#39;: 0.7351351351351352, &#39;eval_f1&#39;: 0.6993865030674845, &#39;eval_runtime&#39;: 9.0807, &#39;eval_samples_per_second&#39;: 20.373, &#39;eval_steps_per_second&#39;: 2.643, &#39;epoch&#39;: 1.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 220/440 [04:38&lt;03:37,  1.01it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.5283, &#39;learning_rate&#39;: 1.2139402178900734e-05, &#39;epoch&#39;: 2.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 220/440 [04:47&lt;03:37,  1.01it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.5323321223258972, &#39;eval_accuracy&#39;: 0.7621621621621621, &#39;eval_f1&#39;: 0.808695652173913, &#39;eval_runtime&#39;: 8.8366, &#39;eval_samples_per_second&#39;: 20.936, &#39;eval_steps_per_second&#39;: 2.716, &#39;epoch&#39;: 2.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 330/440 [07:13&lt;01:47,  1.03it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.4197, &#39;learning_rate&#39;: 6.0971658002623586e-06, &#39;epoch&#39;: 3.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 330/440 [07:23&lt;01:47,  1.03it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.43111473321914673, &#39;eval_accuracy&#39;: 0.8324324324324325, &#39;eval_f1&#39;: 0.8472906403940886, &#39;eval_runtime&#39;: 9.3403, &#39;eval_samples_per_second&#39;: 19.807, &#39;eval_steps_per_second&#39;: 2.57, &#39;epoch&#39;: 3.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [09:39&lt;00:00,  1.03s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.3623, &#39;learning_rate&#39;: 5.492942162398522e-08, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [09:47&lt;00:00,  1.03s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.42529231309890747, &#39;eval_accuracy&#39;: 0.8216216216216217, &#39;eval_f1&#39;: 0.835820895522388, &#39;eval_runtime&#39;: 7.9565, &#39;eval_samples_per_second&#39;: 23.252, &#39;eval_steps_per_second&#39;: 3.016, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [10:02&lt;00:00,  1.37s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;train_runtime&#39;: 602.74, &#39;train_samples_per_second&#39;: 11.634, &#39;train_steps_per_second&#39;: 0.73, &#39;train_loss&#39;: 0.4930061947215687, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 24/24 [00:08&lt;00:00,  2.87it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.42529231309890747, &#39;eval_accuracy&#39;: 0.8216216216216217, &#39;eval_f1&#39;: 0.835820895522388, &#39;eval_runtime&#39;: 8.8189, &#39;eval_samples_per_second&#39;: 20.978, &#39;eval_steps_per_second&#39;: 2.721, &#39;epoch&#39;: 4.0}
------------------------- End of training
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<hr class="docutils" />
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">EPOCHS</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">TRIALS</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># We will make the trial 2 by 2 until reaching the desired number of trials</span>

<span class="c1"># let us initialize the arguments before the training function be fed</span>
<span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;epochs&#39;</span><span class="p">:</span> <span class="n">EPOCHS</span><span class="p">,</span>
        <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="n">model</span><span class="p">,</span>
        <span class="s1">&#39;trainer&#39;</span><span class="p">:</span> <span class="n">Trainer</span><span class="p">,</span>
        <span class="s1">&#39;get_datasets&#39;</span><span class="p">:</span> <span class="n">get_datasets</span><span class="p">,</span>
        <span class="s1">&#39;seed&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;metric&#39;</span><span class="p">:</span> <span class="s1">&#39;f1&#39;</span><span class="p">}</span>


<span class="c1"># let us instantiate the search function we will indicate the output dir as random kwarg initialization of the trainer</span>
<span class="n">bo_search</span> <span class="o">=</span> <span class="n">SimpleBayesianOptimizationForFakeReal</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">search_spaces</span><span class="p">,</span> <span class="n">random_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;output_dir&#39;</span><span class="p">:</span> <span class="s1">&#39;data/checkpoints/model_&#39;</span><span class="p">},</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">checkpoint</span><span class="o">=</span><span class="s1">&#39;data/trials/checkpoint_2.txt&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Checkpoint loaded at trial 18
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bo_search</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">n_trials</span><span class="o">=</span><span class="n">TRIALS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;output_dir&#39;: &#39;data/checkpoints/model_OZe30nD&#39;}
------------------------- Beginning of training
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Some weights of the model checkpoint at google/vit-base-patch16-224-in21k were not used when initializing ViTForImageClassification: [&#39;pooler.dense.bias&#39;, &#39;pooler.dense.weight&#39;]
- This IS expected if you are initializing ViTForImageClassification from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing ViTForImageClassification from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of ViTForImageClassification were not initialized from the model checkpoint at google/vit-base-patch16-224-in21k and are newly initialized: [&#39;classifier.bias&#39;, &#39;classifier.weight&#39;]
You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Current Config:
 {
    &#34;lr&#34;: 9.474979774366729e-05,
    &#34;batch_size&#34;: 16,
    &#34;h_flip_p&#34;: 0.14995067958799224,
    &#34;v_flip_p&#34;: 0.2712280698131356,
    &#34;gray_scale_p&#34;: 0.09845885146155786,
    &#34;rotation&#34;: 1
}
Checkpoints in data/checkpoints/model_OZe30nD
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Using the `WANDB_DISABLED` environment variable is deprecated and will be removed in v5. Use the --report_to flag to control the integrations used for logging result (for instance --report_to none).
 25%|‚ñà‚ñà‚ñå       | 110/440 [02:00&lt;05:14,  1.05it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.6807, &#39;learning_rate&#39;: 7.106234830775047e-05, &#39;epoch&#39;: 1.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 25%|‚ñà‚ñà‚ñå       | 110/440 [02:07&lt;05:14,  1.05it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.6044341325759888, &#39;eval_accuracy&#39;: 0.6702702702702703, &#39;eval_f1&#39;: 0.680628272251309, &#39;eval_runtime&#39;: 6.9793, &#39;eval_samples_per_second&#39;: 26.507, &#39;eval_steps_per_second&#39;: 3.439, &#39;epoch&#39;: 1.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 220/440 [04:19&lt;03:31,  1.04it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.5724, &#39;learning_rate&#39;: 4.7374898871833646e-05, &#39;epoch&#39;: 2.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 220/440 [04:28&lt;03:31,  1.04it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.5266271829605103, &#39;eval_accuracy&#39;: 0.7621621621621621, &#39;eval_f1&#39;: 0.8070175438596492, &#39;eval_runtime&#39;: 8.8722, &#39;eval_samples_per_second&#39;: 20.852, &#39;eval_steps_per_second&#39;: 2.705, &#39;epoch&#39;: 2.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 330/440 [06:46&lt;01:52,  1.03s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.4121, &#39;learning_rate&#39;: 2.3687449435916823e-05, &#39;epoch&#39;: 3.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 330/440 [06:53&lt;01:52,  1.03s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.5404261946678162, &#39;eval_accuracy&#39;: 0.7621621621621621, &#39;eval_f1&#39;: 0.7471264367816092, &#39;eval_runtime&#39;: 6.8279, &#39;eval_samples_per_second&#39;: 27.095, &#39;eval_steps_per_second&#39;: 3.515, &#39;epoch&#39;: 3.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [09:11&lt;00:00,  1.01it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.327, &#39;learning_rate&#39;: 0.0, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [09:18&lt;00:00,  1.01it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.38724860548973083, &#39;eval_accuracy&#39;: 0.827027027027027, &#39;eval_f1&#39;: 0.8461538461538463, &#39;eval_runtime&#39;: 7.688, &#39;eval_samples_per_second&#39;: 24.063, &#39;eval_steps_per_second&#39;: 3.122, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [09:34&lt;00:00,  1.31s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;train_runtime&#39;: 574.5173, &#39;train_samples_per_second&#39;: 12.205, &#39;train_steps_per_second&#39;: 0.766, &#39;train_loss&#39;: 0.4980694597417658, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 24/24 [00:06&lt;00:00,  3.56it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.38724860548973083, &#39;eval_accuracy&#39;: 0.827027027027027, &#39;eval_f1&#39;: 0.8461538461538463, &#39;eval_runtime&#39;: 7.3443, &#39;eval_samples_per_second&#39;: 25.19, &#39;eval_steps_per_second&#39;: 3.268, &#39;epoch&#39;: 4.0}
------------------------- End of training
{&#39;output_dir&#39;: &#39;data/checkpoints/model_lhGqMDq&#39;}
------------------------- Beginning of training
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Some weights of the model checkpoint at google/vit-base-patch16-224-in21k were not used when initializing ViTForImageClassification: [&#39;pooler.dense.bias&#39;, &#39;pooler.dense.weight&#39;]
- This IS expected if you are initializing ViTForImageClassification from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing ViTForImageClassification from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of ViTForImageClassification were not initialized from the model checkpoint at google/vit-base-patch16-224-in21k and are newly initialized: [&#39;classifier.bias&#39;, &#39;classifier.weight&#39;]
You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.
Using the `WANDB_DISABLED` environment variable is deprecated and will be removed in v5. Use the --report_to flag to control the integrations used for logging result (for instance --report_to none).
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Current Config:
 {
    &#34;lr&#34;: 9.230928307664891e-05,
    &#34;batch_size&#34;: 16,
    &#34;h_flip_p&#34;: 0.2294259262936994,
    &#34;v_flip_p&#34;: 0.13244008324902623,
    &#34;gray_scale_p&#34;: 0.12331375384699172,
    &#34;rotation&#34;: 1
}
Checkpoints in data/checkpoints/model_lhGqMDq
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 25%|‚ñà‚ñà‚ñå       | 110/440 [02:05&lt;05:30,  1.00s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.6551, &#39;learning_rate&#39;: 6.923196230748668e-05, &#39;epoch&#39;: 1.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 25%|‚ñà‚ñà‚ñå       | 110/440 [02:13&lt;05:30,  1.00s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.6143904328346252, &#39;eval_accuracy&#39;: 0.6702702702702703, &#39;eval_f1&#39;: 0.6772486772486773, &#39;eval_runtime&#39;: 7.9911, &#39;eval_samples_per_second&#39;: 23.151, &#39;eval_steps_per_second&#39;: 3.003, &#39;epoch&#39;: 1.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 220/440 [04:33&lt;03:42,  1.01s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.5106, &#39;learning_rate&#39;: 4.615464153832446e-05, &#39;epoch&#39;: 2.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 220/440 [04:41&lt;03:42,  1.01s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.4895593523979187, &#39;eval_accuracy&#39;: 0.7675675675675676, &#39;eval_f1&#39;: 0.7860696517412936, &#39;eval_runtime&#39;: 7.6354, &#39;eval_samples_per_second&#39;: 24.229, &#39;eval_steps_per_second&#39;: 3.143, &#39;epoch&#39;: 2.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 330/440 [06:57&lt;01:48,  1.02it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.4299, &#39;learning_rate&#39;: 2.307732076916223e-05, &#39;epoch&#39;: 3.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 330/440 [07:05&lt;01:48,  1.02it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.435648649930954, &#39;eval_accuracy&#39;: 0.8108108108108109, &#39;eval_f1&#39;: 0.8044692737430168, &#39;eval_runtime&#39;: 8.1072, &#39;eval_samples_per_second&#39;: 22.819, &#39;eval_steps_per_second&#39;: 2.96, &#39;epoch&#39;: 3.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [09:30&lt;00:00,  1.03s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.2903, &#39;learning_rate&#39;: 0.0, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [09:37&lt;00:00,  1.03s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.32448598742485046, &#39;eval_accuracy&#39;: 0.8594594594594595, &#39;eval_f1&#39;: 0.8673469387755102, &#39;eval_runtime&#39;: 7.1509, &#39;eval_samples_per_second&#39;: 25.871, &#39;eval_steps_per_second&#39;: 3.356, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [09:52&lt;00:00,  1.35s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;train_runtime&#39;: 593.6357, &#39;train_samples_per_second&#39;: 11.812, &#39;train_steps_per_second&#39;: 0.741, &#39;train_loss&#39;: 0.47146494605324485, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 24/24 [00:07&lt;00:00,  3.20it/s]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.32448598742485046, &#39;eval_accuracy&#39;: 0.8594594594594595, &#39;eval_f1&#39;: 0.8673469387755102, &#39;eval_runtime&#39;: 8.0536, &#39;eval_samples_per_second&#39;: 22.971, &#39;eval_steps_per_second&#39;: 2.98, &#39;epoch&#39;: 4.0}
------------------------- End of training
</pre></div></div>
</div>
<hr class="docutils" />
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">EPOCHS</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">TRIALS</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># We will make the trial 2 by 2 until reaching the desired number of trials</span>

<span class="c1"># let us initialize the arguments before the training function be fed</span>
<span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;epochs&#39;</span><span class="p">:</span> <span class="n">EPOCHS</span><span class="p">,</span>
        <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="n">model</span><span class="p">,</span>
        <span class="s1">&#39;trainer&#39;</span><span class="p">:</span> <span class="n">Trainer</span><span class="p">,</span>
        <span class="s1">&#39;get_datasets&#39;</span><span class="p">:</span> <span class="n">get_datasets</span><span class="p">,</span>
        <span class="s1">&#39;seed&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s1">&#39;metric&#39;</span><span class="p">:</span> <span class="s1">&#39;f1&#39;</span><span class="p">}</span>


<span class="c1"># let us instantiate the search function we will indicate the output dir as random kwarg initialization of the trainer</span>
<span class="n">bo_search</span> <span class="o">=</span> <span class="n">SimpleBayesianOptimizationForFakeReal</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">search_spaces</span><span class="p">,</span> <span class="n">random_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;output_dir&#39;</span><span class="p">:</span> <span class="s1">&#39;data/checkpoints/model_&#39;</span><span class="p">},</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">checkpoint</span><span class="o">=</span><span class="s1">&#39;data/trials/checkpoint_2.txt&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Checkpoint loaded at trial 20
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bo_search</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">n_trials</span><span class="o">=</span><span class="n">TRIALS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;output_dir&#39;: &#39;data/checkpoints/model_Xll9TtZ&#39;}
------------------------- Beginning of training
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Some weights of the model checkpoint at google/vit-base-patch16-224-in21k were not used when initializing ViTForImageClassification: [&#39;pooler.dense.bias&#39;, &#39;pooler.dense.weight&#39;]
- This IS expected if you are initializing ViTForImageClassification from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing ViTForImageClassification from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of ViTForImageClassification were not initialized from the model checkpoint at google/vit-base-patch16-224-in21k and are newly initialized: [&#39;classifier.bias&#39;, &#39;classifier.weight&#39;]
You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.
Using the `WANDB_DISABLED` environment variable is deprecated and will be removed in v5. Use the --report_to flag to control the integrations used for logging result (for instance --report_to none).
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Current Config:
 {
    &#34;lr&#34;: 1.2827166224771633e-05,
    &#34;batch_size&#34;: 16,
    &#34;h_flip_p&#34;: 0.16521424454024936,
    &#34;v_flip_p&#34;: 0.25707805990429455,
    &#34;gray_scale_p&#34;: 0.1392386319822735,
    &#34;rotation&#34;: 1
}
Checkpoints in data/checkpoints/model_Xll9TtZ
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 25%|‚ñà‚ñà‚ñå       | 110/440 [01:54&lt;05:59,  1.09s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.6806, &#39;learning_rate&#39;: 9.620374668578724e-06, &#39;epoch&#39;: 1.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 25%|‚ñà‚ñà‚ñå       | 110/440 [02:02&lt;05:59,  1.09s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.6590978503227234, &#39;eval_accuracy&#39;: 0.6702702702702703, &#39;eval_f1&#39;: 0.7024390243902439, &#39;eval_runtime&#39;: 7.508, &#39;eval_samples_per_second&#39;: 24.64, &#39;eval_steps_per_second&#39;: 3.197, &#39;epoch&#39;: 1.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 220/440 [04:23&lt;03:44,  1.02s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.6098, &#39;learning_rate&#39;: 6.413583112385816e-06, &#39;epoch&#39;: 2.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 220/440 [04:32&lt;03:44,  1.02s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.599656879901886, &#39;eval_accuracy&#39;: 0.7297297297297297, &#39;eval_f1&#39;: 0.7747747747747746, &#39;eval_runtime&#39;: 8.772, &#39;eval_samples_per_second&#39;: 21.09, &#39;eval_steps_per_second&#39;: 2.736, &#39;epoch&#39;: 2.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 330/440 [06:58&lt;01:49,  1.00it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.5331, &#39;learning_rate&#39;: 3.206791556192908e-06, &#39;epoch&#39;: 3.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 330/440 [07:05&lt;01:49,  1.00it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.5277752876281738, &#39;eval_accuracy&#39;: 0.7945945945945946, &#39;eval_f1&#39;: 0.7956989247311828, &#39;eval_runtime&#39;: 7.1039, &#39;eval_samples_per_second&#39;: 26.042, &#39;eval_steps_per_second&#39;: 3.378, &#39;epoch&#39;: 3.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [09:20&lt;00:00,  1.06s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.49, &#39;learning_rate&#39;: 0.0, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [09:29&lt;00:00,  1.06s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.5125455260276794, &#39;eval_accuracy&#39;: 0.7945945945945946, &#39;eval_f1&#39;: 0.8041237113402061, &#39;eval_runtime&#39;: 8.2306, &#39;eval_samples_per_second&#39;: 22.477, &#39;eval_steps_per_second&#39;: 2.916, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [09:44&lt;00:00,  1.33s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;train_runtime&#39;: 584.3075, &#39;train_samples_per_second&#39;: 12.001, &#39;train_steps_per_second&#39;: 0.753, &#39;train_loss&#39;: 0.5783688978715377, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 24/24 [00:11&lt;00:00,  2.18it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.5125455260276794, &#39;eval_accuracy&#39;: 0.7945945945945946, &#39;eval_f1&#39;: 0.8041237113402061, &#39;eval_runtime&#39;: 12.0302, &#39;eval_samples_per_second&#39;: 15.378, &#39;eval_steps_per_second&#39;: 1.995, &#39;epoch&#39;: 4.0}
------------------------- End of training
{&#39;output_dir&#39;: &#39;data/checkpoints/model_KrJltW3&#39;}
------------------------- Beginning of training
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Some weights of the model checkpoint at google/vit-base-patch16-224-in21k were not used when initializing ViTForImageClassification: [&#39;pooler.dense.bias&#39;, &#39;pooler.dense.weight&#39;]
- This IS expected if you are initializing ViTForImageClassification from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing ViTForImageClassification from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of ViTForImageClassification were not initialized from the model checkpoint at google/vit-base-patch16-224-in21k and are newly initialized: [&#39;classifier.bias&#39;, &#39;classifier.weight&#39;]
You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.
Using the `WANDB_DISABLED` environment variable is deprecated and will be removed in v5. Use the --report_to flag to control the integrations used for logging result (for instance --report_to none).
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Current Config:
 {
    &#34;lr&#34;: 6.754841186120955e-05,
    &#34;batch_size&#34;: 16,
    &#34;h_flip_p&#34;: 0.012505377611333468,
    &#34;v_flip_p&#34;: 0.13751465918455963,
    &#34;gray_scale_p&#34;: 0.11160536907441138,
    &#34;rotation&#34;: 1
}
Checkpoints in data/checkpoints/model_KrJltW3
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 25%|‚ñà‚ñà‚ñå       | 110/440 [02:18&lt;05:53,  1.07s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.6457, &#39;learning_rate&#39;: 5.0661308895907166e-05, &#39;epoch&#39;: 1.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 25%|‚ñà‚ñà‚ñå       | 110/440 [02:26&lt;05:53,  1.07s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.5638249516487122, &#39;eval_accuracy&#39;: 0.7135135135135136, &#39;eval_f1&#39;: 0.7253886010362695, &#39;eval_runtime&#39;: 8.2477, &#39;eval_samples_per_second&#39;: 22.431, &#39;eval_steps_per_second&#39;: 2.91, &#39;epoch&#39;: 1.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 220/440 [04:43&lt;03:46,  1.03s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.4946, &#39;learning_rate&#39;: 3.3774205930604775e-05, &#39;epoch&#39;: 2.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 220/440 [04:51&lt;03:46,  1.03s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.5139048099517822, &#39;eval_accuracy&#39;: 0.772972972972973, &#39;eval_f1&#39;: 0.8189655172413793, &#39;eval_runtime&#39;: 7.7977, &#39;eval_samples_per_second&#39;: 23.725, &#39;eval_steps_per_second&#39;: 3.078, &#39;epoch&#39;: 2.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 330/440 [07:15&lt;02:05,  1.14s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.3691, &#39;learning_rate&#39;: 1.7040622083168774e-05, &#39;epoch&#39;: 3.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

 75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 330/440 [07:24&lt;02:05,  1.14s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.42719826102256775, &#39;eval_accuracy&#39;: 0.8108108108108109, &#39;eval_f1&#39;: 0.8022598870056498, &#39;eval_runtime&#39;: 9.4885, &#39;eval_samples_per_second&#39;: 19.497, &#39;eval_steps_per_second&#39;: 2.529, &#39;epoch&#39;: 3.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [09:38&lt;00:00,  1.21it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;loss&#39;: 0.2857, &#39;learning_rate&#39;: 1.5351911786638533e-07, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [09:44&lt;00:00,  1.21it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.3556261360645294, &#39;eval_accuracy&#39;: 0.8594594594594595, &#39;eval_f1&#39;: 0.8645833333333334, &#39;eval_runtime&#39;: 6.6377, &#39;eval_samples_per_second&#39;: 27.871, &#39;eval_steps_per_second&#39;: 3.616, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 440/440 [09:56&lt;00:00,  1.36s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;train_runtime&#39;: 596.6632, &#39;train_samples_per_second&#39;: 11.752, &#39;train_steps_per_second&#39;: 0.737, &#39;train_loss&#39;: 0.4487828991629861, &#39;epoch&#39;: 4.0}
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 24/24 [00:06&lt;00:00,  3.77it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;eval_loss&#39;: 0.3556261360645294, &#39;eval_accuracy&#39;: 0.8594594594594595, &#39;eval_f1&#39;: 0.8645833333333334, &#39;eval_runtime&#39;: 6.5768, &#39;eval_samples_per_second&#39;: 28.129, &#39;eval_steps_per_second&#39;: 3.649, &#39;epoch&#39;: 4.0}
------------------------- End of training
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<p>The best model is located at <code class="docutils literal notranslate"><span class="pre">data/checkpoints/model_lhGqMDq</span></code> with an accuracy of 85.946 and an f1_score of 86.735.</p>
<p>Let us make some predictions on the set in <a class="reference internal" href="predictions.html"><span class="doc">predictions</span></a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="vit_model.html" class="btn btn-neutral float-left" title="Vision Transformer Model + Configuration and Metrics üëì" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="predictions.html" class="btn btn-neutral float-right" title="Make predictions with the best model." accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Oumar Kane.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>